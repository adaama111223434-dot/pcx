
local function clamp(val, min_val, max_val)
    if val < min_val then return min_val end
    if val > max_val then return max_val end
    return val
end

local ease = {}

function ease.quad_in_out(t)
    if t < 0.5 then return 2 * t * t end
    return -1 + (4 - 2 * t) * t
end

function ease.quartic_out(t)
    local f = t - 1
    return 1 - f * f * f * f
end

function ease.cosine_in_out(t)
    return 0.5 * (1 - math.cos(math.pi * t))
end

function ease.cubic_in(t)
    return t * t * t
end

function ease.sine_out(t)
    return math.sin(t * math.pi * 0.5)
end

function ease.expo_in(t)
    if t <= 0 then return 0 end
    return math.pow(2, 10 * (t - 1))
end

function ease.linear(t)
    return t
end

function ease.apply(current, target, speed, easing_fn)
    local ft = globals.get_frame_time()
    if ft <= 0 then ft = 0.016 end
    ft = clamp(ft, 0.001, 0.1)
    
    local diff = target - current
    if math.abs(diff) < 0.001 then return target end
    

    local step = ft * speed
    step = clamp(step, 0, 1)
    

    if easing_fn then
        step = easing_fn(step)
    end
    
    return current + diff * clamp(step, 0.01, 1)
end

local weapon_icons = {}
local icons_loaded = false

local SVG_SMOKE = [[
<svg width="15" height="32" viewBox="0 0 15 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.2822 9.81912V9.3855L13.6062 8.43874V7.73573L13.3085 7.41116L10.6312 0.595254L10.3335 0.568313V0H9.71007V0.161642L9.03528 1.1084C9.00834 0.891597 8.84541 0.864657 8.62861 0.864657C8.62861 0.864657 4.16549 0.837716 3.32777 0.864657C2.49006 0.891597 2.6517 1.40603 2.62476 2.11033H2.46183V2.89416H3.67928V4.92367C3.67928 4.92367 3.40988 5.11225 3.38165 5.46504C3.37396 5.57537 3.37011 5.7229 3.37011 5.87043C0.904426 6.1347 0 6.79025 0 6.79025V30.3233C0 30.3233 1.39064 32 5.98076 32C9.80885 32 11.7935 30.431 11.7935 30.431V7.44195L13.5253 10.0616L13.5792 27.3457C13.3368 27.8063 13.1469 28.2656 13.3085 28.2656C13.4702 28.2656 13.9846 28.2656 13.9846 28.2656L14.4439 27.914V9.873L14.2822 9.81912ZM11.2534 25.4804C11.2534 25.4804 8.9814 26.1706 5.89737 26.2104C2.81334 26.2514 0.500321 25.4804 0.500321 25.4804V23.7768C0.500321 23.7768 2.75946 24.467 5.89737 24.4529C8.94291 24.44 11.2534 23.7768 11.2534 23.7768V25.4804Z" fill="white"/>
</svg>
]]

local SVG_MOLOTOV = [[
<svg width="22" height="32" viewBox="0 0 22 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M18.6604 4.05376C18.7193 4.14102 18.8785 4.35915 19.1403 4.70699C19.3431 4.97111 19.5034 5.04303 19.619 4.9263C19.7357 4.80957 19.619 4.47588 19.2712 3.92288C18.8927 3.34158 18.9516 2.70251 19.4457 2.0033C19.5034 2.29454 19.8525 2.73081 20.4927 3.31211C21.133 3.92288 21.5244 4.51833 21.6706 5.10081C21.7284 5.39087 21.7426 5.68211 21.7143 5.97217C21.6565 6.40844 21.5398 6.75745 21.3664 7.01921C21.0752 7.3977 20.916 7.64414 20.8865 7.76205C20.7981 7.96603 20.8712 8.21247 21.1047 8.50371C21.3075 8.79259 21.2497 9.18523 20.9302 9.68045C20.7262 9.97051 20.2616 10.5235 19.5353 11.3371C19.1167 11.804 18.4989 12.0658 17.6806 12.1224C17.8834 11.7934 18.0944 11.4444 18.3137 11.0765C18.4305 11.0765 18.5036 11.06 18.533 11.0317L19.8419 9.243C19.8996 9.12627 19.8253 8.93762 19.6225 8.67703C19.3903 8.41527 19.0849 8.13936 18.7076 7.84694C18.3302 7.58754 17.98 7.3977 17.6605 7.28097C17.3127 7.13712 17.1075 7.12061 17.0497 7.23852L15.7409 9.02723H15.7857C15.7574 9.08618 15.7574 9.17226 15.7857 9.28781C15.2846 9.8868 14.8413 10.4162 14.4557 10.8808C14.4133 10.8489 14.3767 10.8112 14.346 10.7735C14.1126 10.4539 13.8956 10.0165 13.6916 9.46468C13.4594 8.67939 13.4157 8.04032 13.5608 7.54627C13.7942 7.10882 13.9676 6.78929 14.0843 6.5853C14.2883 6.17851 14.2883 5.62669 14.0843 4.92866L14.5642 5.10317C14.9415 5.30715 15.2186 5.62669 15.3919 6.06178C15.4803 6.20799 15.5228 6.60063 15.5228 7.2397C15.5228 7.73257 15.5358 7.89411 15.5664 7.71842C15.9143 7.25385 16.1324 6.77396 16.2196 6.27991C16.2491 5.98985 16.0605 5.53826 15.6537 4.92748C15.1313 4.28841 14.8118 3.88043 14.6951 3.70711C14.5206 3.44417 14.4474 2.83575 14.4757 1.87596C14.5052 0.886687 14.6503 0.261761 14.912 0C14.971 0.610776 15.2316 1.14845 15.6973 1.61302C15.9308 1.84412 16.5557 2.10706 17.5721 2.3983C17.98 2.51503 18.2265 2.76264 18.3137 3.13996C18.4564 3.66112 18.5731 3.96533 18.6604 4.05376Z" fill="white" fill-opacity="0.6"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M17.657 7.27979C17.9765 7.3977 18.3267 7.58754 18.704 7.84576C19.0813 8.13818 19.3879 8.41409 19.619 8.67585C19.8218 8.93761 19.8961 9.12627 19.8383 9.24182L18.5295 11.0305C18.5 11.0588 18.4269 11.0753 18.3102 11.0753C16.7113 13.7507 15.7657 15.2894 15.4756 15.6974C15.3589 15.8413 15.228 16.6442 15.0818 18.0957C14.9085 19.5201 14.6031 20.553 14.1668 21.192L6.57928 31.8358C6.347 32.0386 5.82348 32.054 5.00871 31.8795C4.13736 31.6472 3.29312 31.2392 2.48071 30.6567C1.66595 30.0778 1.01155 29.4069 0.516325 28.6522C0.080056 27.953 -0.0791231 27.4602 0.0364291 27.1678L7.62633 16.4827C8.0626 15.8413 8.93513 15.2187 10.2439 14.6067C10.5635 14.4617 10.9997 14.2577 11.5516 13.996C11.9595 13.792 12.2201 13.6187 12.338 13.4736C12.5125 13.2095 13.661 11.8158 15.7834 9.28427C15.7551 9.16872 15.7551 9.08264 15.7834 9.02369H15.7386L17.0474 7.23498C17.104 7.11943 17.308 7.13594 17.657 7.27979Z" fill="white"/>
</svg>
]]

local SVG_HE = [[
<svg width="25" height="33" viewBox="0 0 25 33" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M19.6203 6.8543C19.6203 6.88516 19.6203 6.91729 19.6203 6.94686C19.6486 6.97643 19.664 7.00856 19.664 7.03942C19.664 7.06898 19.6794 7.09983 19.7103 7.13197V7.17696C19.7424 7.20653 19.7578 7.23867 19.7578 7.26952C19.7887 7.29909 19.8182 7.32994 19.8491 7.36079V7.40707C19.8491 7.43792 19.8658 7.45206 19.8954 7.45206C19.8954 7.48291 19.8954 7.51377 19.8954 7.54462C19.9275 7.57418 19.9416 7.60632 19.9416 7.63717C19.9416 7.66803 19.9571 7.69888 19.9892 7.73102L20.0342 7.77601C20.0342 7.80686 20.0342 7.83643 20.0342 7.86728C20.0663 7.89685 20.0818 7.92898 20.0818 7.95855L20.128 8.00611V8.05111C20.128 8.08067 20.128 8.11409 20.128 8.14495C20.1589 8.1758 20.1898 8.20408 20.2206 8.23622C20.2206 8.26707 20.2347 8.29664 20.2643 8.33006L20.3106 8.37634C20.3106 8.4059 20.3106 8.43676 20.3106 8.46761C20.3414 8.49718 20.3582 8.52931 20.3582 8.56016V8.60644C20.3877 8.60644 20.4031 8.62058 20.4031 8.65143C20.4031 8.67972 20.4031 8.71314 20.4031 8.74271C20.4353 8.77227 20.4494 8.80441 20.4494 8.83526C20.4803 8.86483 20.4957 8.89568 20.4957 8.92782C20.5253 8.92782 20.542 8.94453 20.542 8.9741C20.5715 9.00366 20.5895 9.03451 20.5895 9.06665C20.6191 9.0975 20.6332 9.12707 20.6332 9.15792C20.6654 9.15792 20.695 9.15792 20.7245 9.15792C20.7245 9.18877 20.7554 9.20549 20.8184 9.20549C20.8492 9.23377 20.8788 9.26462 20.9096 9.29547C20.9392 9.32632 20.9572 9.35589 20.9572 9.38803C20.9855 9.41888 21.0022 9.44973 21.0022 9.4793V9.57314C21.0318 9.60142 21.0485 9.63227 21.0485 9.66184C21.0485 9.69526 21.0652 9.72354 21.0947 9.75311V9.80196C21.0947 9.83153 21.1089 9.86109 21.141 9.89194C21.141 9.9228 21.141 9.95236 21.141 9.98579C21.1719 10.0166 21.1873 10.0462 21.1873 10.0771C21.2182 10.0771 21.2349 10.0925 21.2349 10.122V10.1696C21.2657 10.1992 21.2811 10.2287 21.2811 10.2609C21.2811 10.2917 21.2811 10.3226 21.2811 10.3547L21.3261 10.401C21.3261 10.4306 21.3403 10.4589 21.3737 10.491C21.3737 10.5218 21.3891 10.554 21.42 10.5835C21.42 10.6131 21.42 10.644 21.42 10.6761C21.4521 10.6761 21.4663 10.6902 21.4663 10.7224L21.5112 10.7699C21.5434 10.7995 21.5575 10.8291 21.5575 10.8612C21.5884 10.8946 21.6038 10.9229 21.6038 10.9525V11C21.6334 11.0296 21.6501 11.0605 21.6501 11.0913C21.6796 11.1235 21.6976 11.1543 21.6976 11.1839L21.7414 11.2289C21.7735 11.2597 21.7876 11.2893 21.7876 11.3189L21.8352 11.3677C21.8352 11.3973 21.8352 11.4268 21.8352 11.4603C21.8648 11.4898 21.8789 11.5207 21.8789 11.5515L21.9265 11.5978C21.9265 11.6261 21.9419 11.6582 21.9727 11.6904C21.9727 11.7199 21.9869 11.7534 22.0164 11.7816V11.8279C22.0499 11.8588 22.0653 11.8883 22.0653 11.9205L22.109 11.9667C22.1411 11.9963 22.1566 12.0272 22.1566 12.058C22.1566 12.0889 22.172 12.1043 22.2016 12.1043C22.2016 12.1339 22.2016 12.166 22.2016 12.1968C22.2324 12.2277 22.2478 12.2573 22.2478 12.2894C22.2787 12.319 22.2941 12.3511 22.2941 12.382L22.3417 12.427C22.3712 12.4578 22.388 12.4899 22.388 12.5195L22.433 12.5658C22.433 12.5966 22.433 12.6262 22.433 12.6583L22.4779 12.7033C22.4779 12.7368 22.4779 12.765 22.4779 12.7946C22.4779 12.8255 22.4947 12.8576 22.5255 12.8872C22.5255 12.918 22.5255 12.9502 22.5255 12.981C22.5551 12.981 22.5718 12.9951 22.5718 13.0247C22.6026 13.0543 22.6168 13.0864 22.6168 13.1186V13.1635C22.6489 13.1944 22.6798 13.224 22.7093 13.2561L22.7569 13.3037C22.7569 13.3332 22.7569 13.3641 22.7569 13.3949C22.7569 13.4258 22.7723 13.4566 22.8019 13.4862C22.8019 13.5171 22.8019 13.5492 22.8019 13.5788C22.8327 13.5788 22.8495 13.5942 22.8495 13.6238C22.8495 13.6559 22.8495 13.6867 22.8495 13.7176L22.8944 13.7652C22.8944 13.7947 22.8944 13.8243 22.8944 13.8539L22.9407 13.904C22.9407 13.9323 22.9562 13.9618 22.9857 13.9927C22.9857 14.0223 23.0024 14.0531 23.0333 14.084V14.1315C23.0333 14.1637 23.0333 14.1919 23.0333 14.2241C23.0628 14.2537 23.0796 14.2858 23.0796 14.3154L23.1271 14.3629C23.1567 14.3912 23.1863 14.4233 23.2197 14.4529V14.5005C23.2505 14.5313 23.2647 14.5622 23.2647 14.593C23.2647 14.6226 23.2647 14.6534 23.2647 14.6843L23.3109 14.7306C23.3418 14.7601 23.3572 14.7936 23.3572 14.8218C23.3572 14.8527 23.3572 14.8848 23.3572 14.917L23.4048 14.962V15.007C23.4356 15.0378 23.4652 15.0687 23.4961 15.1008C23.4961 15.1304 23.5115 15.1612 23.5423 15.1908C23.5423 15.2216 23.5578 15.2538 23.5873 15.2859C23.5873 15.3142 23.604 15.3322 23.6336 15.3322C23.6336 15.3618 23.6336 15.3926 23.6336 15.4222C23.6336 15.4543 23.6336 15.4839 23.6336 15.516L23.7249 15.6086C23.757 15.6381 23.7866 15.669 23.8174 15.6986C23.8174 15.7294 23.8174 15.7615 23.8174 15.7911C23.8483 15.8207 23.8791 15.8541 23.91 15.8862V15.9299C23.9396 15.9608 23.955 15.9917 23.955 16.0238C23.9871 16.0534 24.0026 16.0855 24.0026 16.1151V16.1613C24.0321 16.1922 24.063 16.2089 24.0951 16.2089C24.0951 16.2398 24.1105 16.2706 24.1414 16.3015C24.1414 16.331 24.1568 16.3619 24.1877 16.3927C24.1877 16.4236 24.2018 16.4544 24.2339 16.484V16.529C24.2339 16.5611 24.2339 16.592 24.2339 16.6228C24.2635 16.6524 24.2776 16.6833 24.2776 16.7141L24.3252 16.7617C24.3561 16.7617 24.3856 16.7758 24.4178 16.8079C24.4178 16.8388 24.4178 16.8709 24.4178 16.8992C24.4473 16.9314 24.4628 16.9609 24.4628 16.9918L24.509 17.0368V17.0843C24.509 17.1152 24.509 17.1447 24.509 17.1756V17.2232C24.5412 17.2232 24.572 17.2373 24.6029 17.2669C24.6029 17.299 24.617 17.3311 24.6466 17.3594C24.6774 17.3594 24.6929 17.3736 24.6929 17.4044C24.6929 17.434 24.7096 17.4661 24.7391 17.4957V17.5433C24.7391 17.5741 24.7391 17.6037 24.7391 17.6345V17.6821C24.7391 17.7117 24.7391 17.7425 24.7391 17.7721C24.7391 17.8016 24.7391 17.8351 24.7391 17.8646C24.7391 17.8968 24.7391 17.9276 24.7391 17.9585C24.7096 17.9585 24.6929 17.9726 24.6929 18.0022C24.6929 18.0343 24.6929 18.0639 24.6929 18.0947L24.6466 18.141C24.6466 18.3248 24.6466 18.5087 24.6466 18.6938C24.6466 18.9085 24.6466 19.1218 24.6466 19.3365C24.6466 19.5512 24.6466 19.7659 24.6466 19.9806C24.6466 20.2274 24.6466 20.4562 24.6466 20.6722C24.6466 20.9151 24.6466 21.1478 24.6466 21.3625C24.6466 21.6093 24.6466 21.8214 24.6466 22.0065C24.6466 22.1608 24.6466 22.2983 24.6466 22.423C24.6466 22.4526 24.6466 22.4822 24.6466 22.513V22.6981C24.6466 22.7264 24.6466 22.7585 24.6466 22.7894V22.9256C24.6466 22.9565 24.6466 22.9886 24.6466 23.0208C24.6466 23.0503 24.6466 23.0812 24.6466 23.112V23.1583C24.6466 23.1879 24.6466 23.2175 24.6466 23.2496V23.2959C24.6466 23.3267 24.6466 23.3576 24.6466 23.3871C24.6466 23.418 24.6466 23.4488 24.6466 23.4784L24.6929 23.526C24.6929 23.5581 24.6929 23.5877 24.6929 23.6172C24.6929 23.6494 24.7096 23.679 24.7391 23.7085V23.7561C24.7391 23.7869 24.7391 23.8178 24.7391 23.8486V23.8936C24.7391 23.9232 24.7391 23.954 24.7391 23.9849V24.0325C24.7391 24.062 24.7391 24.0929 24.7391 24.1225C24.7391 24.1546 24.7391 24.1842 24.7391 24.2163C24.7391 24.2471 24.7391 24.2767 24.7391 24.3063V24.3538C24.7391 24.3834 24.7391 24.4143 24.7391 24.4464V24.4927C24.7391 24.5235 24.7391 24.5544 24.7391 24.5852V24.6328C24.7391 24.6611 24.7391 24.6906 24.7391 24.7228C24.7391 24.7549 24.7391 24.7845 24.7391 24.8153C24.7391 24.8462 24.7391 24.8758 24.7391 24.9066V24.9542C24.7391 24.9837 24.7391 25.0159 24.7391 25.0454L24.7854 25.0917C24.7854 25.1226 24.7854 25.1509 24.7854 25.1817L24.8317 25.2306C24.8317 25.2601 24.8317 25.291 24.8317 25.3218C24.8317 25.3514 24.8317 25.381 24.8317 25.4131C24.8317 25.4452 24.8317 25.4748 24.8317 25.5031V25.5519C24.8317 25.5828 24.8317 25.6123 24.8317 25.6432V25.6908C24.8317 25.7203 24.8317 25.7512 24.8317 25.782V25.8296C24.8317 25.8605 24.8317 25.8887 24.8317 25.9209C24.8317 25.953 24.8317 25.9839 24.8317 26.0121V26.0584C24.8317 26.0893 24.8317 26.1214 24.8317 26.151C24.8317 26.1805 24.8317 26.2127 24.8317 26.2422V26.2885C24.8317 26.3194 24.8317 26.3502 24.8317 26.3824V26.4299C24.8317 26.4595 24.8317 26.4903 24.8317 26.5199C24.8317 26.5508 24.8317 26.5829 24.8317 26.6138V26.66C24.8317 26.6909 24.8317 26.7205 24.8317 26.7513C24.8317 26.7809 24.8317 26.813 24.8317 26.8439V26.9351C24.8317 26.9647 24.8317 26.9968 24.8317 27.0264C24.8317 27.0573 24.8317 27.0868 24.8317 27.119C24.8317 27.1511 24.8317 27.1819 24.8317 27.2115L24.8767 27.2578C24.8767 27.2874 24.8921 27.3195 24.923 27.3503C24.923 27.3799 24.923 27.4121 24.923 27.4429V27.5329C24.923 27.5637 24.923 27.5959 24.923 27.6254C24.923 27.6563 24.923 27.6859 24.923 27.718C24.923 27.7476 24.923 27.7784 24.923 27.8093V27.8543C24.923 27.8851 24.923 27.9173 24.923 27.9468C24.923 27.9777 24.923 28.0072 24.923 28.0394V28.1306C24.923 28.1615 24.923 28.1911 24.923 28.2232C24.923 28.2553 24.923 28.2862 24.923 28.3145C24.923 28.3466 24.923 28.3787 24.923 28.4096V28.4546C24.923 28.4842 24.923 28.5163 24.923 28.5459C24.923 28.5767 24.923 28.6076 24.923 28.6397V28.731C24.923 28.7618 24.923 28.7914 24.923 28.821C24.923 28.8518 24.923 28.8827 24.923 28.9122C24.923 28.9444 24.923 28.9752 24.923 29.0074C24.8921 29.0074 24.8767 29.0215 24.8767 29.0524C24.8767 29.0832 24.8767 29.1153 24.8767 29.1449C24.8458 29.1732 24.8317 29.204 24.8317 29.2375V29.3287C24.8317 29.3596 24.8317 29.3904 24.8317 29.4213C24.8317 29.4521 24.8317 29.4817 24.8317 29.5126V29.5601C24.8317 29.5884 24.8317 29.6193 24.8317 29.6501C24.8317 29.6797 24.8317 29.7118 24.8317 29.7427C24.8317 29.7722 24.8317 29.8044 24.8317 29.8339V29.9278C24.8317 29.9561 24.8317 29.9869 24.8317 30.019C24.8317 30.0486 24.8317 30.0808 24.8317 30.1116V30.1553C24.8317 30.1887 24.8317 30.2196 24.8317 30.2492C24.8317 30.2787 24.8317 30.3083 24.8317 30.343C24.8317 30.3713 24.8317 30.4021 24.8317 30.433C24.8317 30.4638 24.8317 30.496 24.8317 30.5255C24.8317 30.5564 24.8317 30.5885 24.8317 30.6194C24.8317 30.6477 24.8317 30.6798 24.8317 30.7106V30.7556C24.8317 30.7878 24.8317 30.8173 24.8317 30.8469C24.8317 30.8778 24.8317 30.9099 24.8317 30.9408C24.8317 30.9716 24.8317 31.0025 24.8317 31.0333C24.8317 31.0654 24.815 31.095 24.7854 31.1246C24.7854 31.1554 24.7854 31.1876 24.7854 31.2171C24.7854 31.2467 24.7687 31.2776 24.7391 31.3097L24.6929 31.356C24.6929 31.3868 24.6774 31.4164 24.6466 31.446C24.617 31.4768 24.6029 31.5077 24.6029 31.5385C24.572 31.5707 24.5553 31.6002 24.5553 31.6311H24.5078C24.5078 31.6619 24.4936 31.6928 24.4615 31.7236H24.4062C24.3136 31.7558 24.2519 31.7853 24.2224 31.8149C24.1607 31.8149 24.1002 31.8303 24.0373 31.8599C23.9447 31.8599 23.838 31.8599 23.7146 31.8599C23.6529 31.8303 23.5938 31.8149 23.5321 31.8149C23.5012 31.7853 23.4549 31.7558 23.3945 31.7236C23.3945 31.6928 23.3778 31.6619 23.3469 31.6311V31.5861C23.3469 31.5552 23.3469 31.5244 23.3469 31.4935C23.3469 31.4614 23.3469 31.4318 23.3469 31.4022C23.3469 31.3727 23.3469 31.3405 23.3469 31.3097V31.2621L23.3945 31.2171C23.4254 31.1876 23.4549 31.1554 23.4858 31.1246C23.5166 31.095 23.5475 31.0654 23.577 31.0333C23.6388 31.0333 23.7005 31.0333 23.7609 31.0333C23.7917 31.0037 23.8226 30.9729 23.8521 30.9408C23.8521 30.8469 23.8521 30.7724 23.8521 30.7119C23.8521 30.4973 23.8521 30.2646 23.8521 30.0216C23.8521 29.8069 23.8521 29.5756 23.8521 29.33C23.8521 29.1166 23.8521 28.8994 23.8521 28.686C23.8521 28.47 23.8521 28.2566 23.8521 28.0419C23.8521 27.7951 23.8521 27.5663 23.8521 27.3516C23.8521 27.1048 23.8521 26.8747 23.8521 26.6613C23.8521 26.4479 23.8521 26.2307 23.8521 26.016C23.8521 25.8013 23.8521 25.5712 23.8521 25.327C23.8521 25.111 23.8521 24.8809 23.8521 24.6379C23.8521 24.4515 23.8521 24.2369 23.8521 23.9913C23.8521 23.9296 23.8521 23.8551 23.8521 23.7612V23.5761C23.8521 23.5465 23.8521 23.5144 23.8521 23.4836V23.4373C23.8521 23.4064 23.8521 23.3781 23.8521 23.346V23.2535C23.8521 23.2213 23.8521 23.1917 23.8521 23.1622V22.9758C23.8521 22.9462 23.8521 22.9154 23.8521 22.8858V22.7457C23.8239 22.7161 23.8072 22.6865 23.8072 22.6544C23.7763 22.6236 23.7467 22.6068 23.7146 22.6068C23.7146 22.5773 23.7146 22.5464 23.7146 22.5156V22.4706C23.7146 22.441 23.7146 22.4102 23.7146 22.3767C23.7146 22.3459 23.7146 22.3176 23.7146 22.2855V22.2392C23.7146 22.2096 23.7146 22.1775 23.7146 22.1453C23.7146 22.1158 23.7146 22.0862 23.7146 22.0554V22.0078C23.7146 21.9782 23.7146 21.9474 23.7146 21.9165V21.869C23.7146 21.8394 23.7146 21.8073 23.7146 21.7764V21.7301C23.7146 21.7006 23.7146 21.6697 23.7146 21.6401C23.7146 21.6106 23.7146 21.5797 23.7146 21.5476C23.7146 21.518 23.7146 21.4859 23.7146 21.4563V21.4088C23.685 21.3779 23.6696 21.3496 23.6696 21.3175V21.2699C23.6388 21.2404 23.6233 21.2095 23.6233 21.1774V21.1311C23.6233 21.1015 23.6233 21.0707 23.6233 21.0411C23.6233 21.0103 23.6233 20.9781 23.6233 20.946C23.6233 20.9151 23.6233 20.8868 23.6233 20.856V20.811C23.6233 20.7801 23.6233 20.7493 23.6233 20.7184V20.6722C23.6233 20.6413 23.6233 20.6105 23.6233 20.5809V20.5333C23.6233 20.505 23.6233 20.4729 23.6233 20.4433C23.6233 20.4099 23.6233 20.3791 23.6233 20.3495C23.6233 20.3199 23.6233 20.2891 23.6233 20.2582V20.2107C23.6233 20.1811 23.6233 20.1502 23.6233 20.1194V20.0667C23.6233 20.0358 23.6233 20.005 23.6233 19.9741V19.9279C23.6233 19.8983 23.6233 19.87 23.6233 19.8379C23.6233 19.8057 23.6233 19.7762 23.6233 19.7453C23.5938 19.7145 23.5616 19.6849 23.5321 19.654V19.6065C23.5321 19.5769 23.5321 19.5461 23.5321 19.5152V19.4676C23.5321 19.4381 23.5321 19.4085 23.5321 19.3764V19.3301C23.5321 19.3005 23.5321 19.2671 23.5321 19.2363C23.5321 19.2067 23.5321 19.1758 23.5321 19.145V19.0987C23.5012 19.0704 23.4858 19.0383 23.4858 19.0087C23.4549 18.9779 23.4408 18.9457 23.4408 18.9162V18.8236C23.4408 18.7928 23.4408 18.7619 23.4408 18.7298C23.4408 18.7002 23.4408 18.6706 23.4408 18.6385C23.4408 18.6064 23.4408 18.5768 23.4408 18.5459L23.3945 18.501C23.3637 18.4701 23.3469 18.438 23.3469 18.4084C23.3469 18.3788 23.3469 18.3467 23.3469 18.3171V18.2246C23.3469 18.1963 23.3469 18.1616 23.3469 18.1333C23.3161 18.1024 23.3007 18.0729 23.3007 18.0407C23.3007 18.0086 23.3007 17.9778 23.3007 17.9495C23.2698 17.9495 23.2544 17.9328 23.2544 17.9032C23.2544 17.8711 23.2402 17.8415 23.2094 17.8094C23.2094 17.7798 23.2094 17.7476 23.2094 17.7181C23.1773 17.7181 23.1477 17.7027 23.1168 17.6718V17.6242C23.1168 17.5947 23.1168 17.5638 23.1168 17.533C23.1168 17.5021 23.1168 17.4713 23.1168 17.4404C23.1168 17.4108 23.1168 17.38 23.1168 17.3491V17.3041C23.1168 17.2707 23.1168 17.2412 23.1168 17.2129C23.1168 17.1795 23.1168 17.1499 23.1168 17.119C23.0847 17.119 23.0693 17.1049 23.0693 17.0728C23.0384 17.0728 23.023 17.0573 23.023 17.0252C23.023 16.9956 23.0076 16.9648 22.9754 16.9352C22.9754 16.9044 22.9613 16.8748 22.9304 16.8427C22.9304 16.8131 22.9304 16.7809 22.9304 16.7514C22.9009 16.7514 22.8842 16.736 22.8842 16.7038C22.8842 16.6743 22.87 16.6421 22.8392 16.6125C22.8083 16.5817 22.7916 16.5508 22.7916 16.5187C22.762 16.5187 22.7466 16.5046 22.7466 16.4737V16.4287C22.7158 16.3979 22.6991 16.3683 22.6991 16.3375C22.6695 16.3066 22.6386 16.2745 22.6065 16.2449C22.6065 16.214 22.5924 16.1986 22.5615 16.1986C22.5615 16.1665 22.5448 16.1369 22.5152 16.1061C22.5152 16.0765 22.5152 16.0456 22.5152 16.0148C22.4844 15.9827 22.4677 15.9518 22.4677 15.9209V15.8772L22.4265 15.831C22.4265 15.8001 22.4124 15.7705 22.3815 15.7397C22.3815 15.7088 22.3648 15.6767 22.3353 15.6497C22.3353 15.615 22.3185 15.6021 22.2877 15.6021C22.2877 15.57 22.2877 15.5392 22.2877 15.5096C22.2581 15.4787 22.2414 15.4479 22.2414 15.4157C22.2106 15.3862 22.1951 15.3553 22.1951 15.3258H22.1501C22.1501 15.2936 22.1501 15.2641 22.1501 15.2319C22.1501 15.1998 22.136 15.1715 22.1026 15.1406C22.1026 15.1098 22.1026 15.0802 22.1026 15.0468C22.073 15.0172 22.0447 15.0018 22.01 15.0018C22.01 14.9722 21.9959 14.9401 21.9663 14.9118C21.9355 14.9118 21.9046 14.9118 21.8725 14.9118C21.8429 14.8797 21.7979 14.8488 21.7349 14.8167C21.7041 14.7884 21.6912 14.7563 21.6912 14.7254C21.6591 14.7254 21.6282 14.7113 21.5974 14.6792C21.5974 14.6496 21.5974 14.6174 21.5974 14.5879C21.5665 14.557 21.5511 14.5275 21.5511 14.4953L21.5048 14.4478C21.5048 14.4182 21.5048 14.3861 21.5048 14.3578C21.4753 14.3578 21.4457 14.3398 21.4135 14.3102C21.3827 14.2806 21.3518 14.2498 21.3197 14.2189C21.3197 14.1868 21.3043 14.1585 21.2747 14.1264V14.0788C21.2747 14.0493 21.2593 14.0171 21.2284 13.9876C21.2284 13.9567 21.213 13.9271 21.1809 13.8989C21.1809 13.8641 21.1654 13.8487 21.1346 13.8487C21.1346 13.8192 21.1346 13.7896 21.1346 13.76C21.1025 13.76 21.0883 13.7446 21.0883 13.7125C21.0588 13.6829 21.0266 13.6508 20.997 13.6186V13.5749C20.997 13.5453 20.9803 13.5132 20.9521 13.4824C20.9521 13.4528 20.9521 13.4232 20.9521 13.3911C20.9212 13.3602 20.8903 13.3307 20.8595 13.2998L20.8132 13.2522C20.7824 13.2201 20.7502 13.1905 20.7194 13.1597V13.1147C20.7194 13.0838 20.7194 13.0517 20.7194 13.0209V12.9771C20.6898 12.9463 20.6602 12.9154 20.6281 12.8833C20.5985 12.8537 20.5664 12.8216 20.5368 12.7908C20.5368 12.7612 20.5201 12.7329 20.4906 12.6995L20.4443 12.6545C20.4147 12.6236 20.398 12.5928 20.398 12.5619L20.353 12.5157C20.353 12.4861 20.353 12.4552 20.353 12.4231C20.3222 12.4231 20.3054 12.4064 20.3054 12.3781C20.2746 12.3473 20.245 12.3151 20.2155 12.2855C20.2155 12.2547 20.1987 12.2251 20.1692 12.193C20.137 12.1634 20.1229 12.1313 20.1229 12.1004L20.0766 12.0542C20.0458 12.0246 20.0291 11.9937 20.0291 11.9629C19.9995 11.9629 19.9686 11.9487 19.9365 11.9166C19.9365 11.8858 19.9365 11.8549 19.9365 11.8241C19.9057 11.8241 19.8902 11.8086 19.8902 11.7778C19.8607 11.7495 19.844 11.7161 19.844 11.6865C19.8144 11.6544 19.7835 11.6235 19.7527 11.5939C19.7527 11.5631 19.7373 11.5477 19.7051 11.5477C19.7051 11.5181 19.6897 11.486 19.6588 11.4564C19.6293 11.423 19.5984 11.3934 19.5676 11.3638L19.5213 11.315C19.4917 11.2854 19.4609 11.2559 19.4287 11.225L19.3863 11.18C19.3863 11.1517 19.3696 11.1209 19.3375 11.0875C19.3375 11.0566 19.3375 11.0258 19.3375 10.9962C19.3079 10.9666 19.277 10.9486 19.2462 10.9486C19.2462 10.9191 19.2308 10.8908 19.1999 10.8574C19.1691 10.8265 19.1524 10.7957 19.1524 10.7661C19.1228 10.7661 19.1061 10.7507 19.1061 10.7185C19.0765 10.6864 19.0444 10.6722 19.0161 10.6722C18.9839 10.6414 18.9698 10.6105 18.9698 10.5797C18.9698 10.5501 18.9531 10.518 18.9235 10.4871C17.7563 10.4871 16.5749 10.5038 15.3781 10.5334C15.3781 10.5643 15.3627 10.5797 15.3318 10.5797C15.3318 10.6093 15.3177 10.6401 15.2868 10.6722V10.7185C15.2868 10.7494 15.2868 10.7815 15.2868 10.8111C15.2868 10.8406 15.2868 10.8715 15.2868 10.9036V10.9486C15.2868 10.9795 15.2868 11.0103 15.2868 11.0425C15.2868 11.072 15.2868 11.1042 15.2868 11.1337V11.225C15.2868 11.2559 15.2868 11.2854 15.2868 11.315C15.2868 11.3484 15.2868 11.378 15.2868 11.4088C15.2868 11.4384 15.2868 11.4705 15.2868 11.5001V11.5477C15.2868 11.5772 15.2868 11.6081 15.2868 11.6402C15.2868 11.6698 15.2868 11.7019 15.2868 11.7315V11.8241C15.2868 11.8549 15.2868 11.8845 15.2868 11.9166C15.2868 11.9487 15.2868 11.9783 15.2868 12.0079C15.2868 12.0387 15.2868 12.0709 15.2868 12.1004V12.1467C15.2868 12.1763 15.2868 12.2071 15.2868 12.2393C15.2868 12.2688 15.2868 12.301 15.2868 12.3331V12.4231C15.2868 12.4539 15.2868 12.4861 15.2868 12.5157C15.2868 12.5452 15.2868 12.5774 15.2868 12.6082C15.2868 12.6378 15.2868 12.6673 15.2868 12.6995V12.7458C15.2868 12.7766 15.2868 12.8087 15.2868 12.8383C15.2868 12.8705 15.2868 12.9 15.2868 12.9309V13.0209C15.2868 13.0504 15.2868 13.0826 15.2868 13.1147C15.2868 13.1443 15.2868 13.1738 15.2868 13.206V13.2522C15.2868 13.2818 15.2868 13.3127 15.2868 13.3448C15.3177 13.3448 15.3473 13.3448 15.3781 13.3448C15.409 13.3448 15.4385 13.3448 15.4707 13.3448C15.5619 13.3448 15.6558 13.3589 15.7458 13.3898C15.7458 13.4206 15.7612 13.4374 15.7933 13.4374C15.9142 13.4656 16.0067 13.4811 16.0697 13.4811C16.1301 13.4811 16.1918 13.4978 16.2535 13.5286C16.2857 13.5286 16.3152 13.5286 16.3461 13.5286C16.5299 13.5582 16.7305 13.5736 16.9439 13.5736C17.0364 13.5736 17.1123 13.5736 17.1752 13.5736C17.2035 13.6045 17.2357 13.6186 17.2665 13.6186C17.2974 13.6508 17.3269 13.6675 17.3578 13.6675C17.4195 13.6675 17.4671 13.6829 17.4966 13.7125H17.5442C17.6663 13.7433 17.773 13.76 17.8656 13.76C17.9555 13.76 18.034 13.7742 18.0957 13.8063C18.1252 13.8359 18.1574 13.85 18.1869 13.85C18.2178 13.85 18.2486 13.85 18.2795 13.85C18.3412 13.85 18.3862 13.8654 18.417 13.9001C18.4492 13.9001 18.48 13.9001 18.5096 13.9001C18.57 13.9284 18.6343 13.9413 18.6934 13.9413C18.7551 13.9413 18.8335 13.958 18.9248 13.9888C18.9544 14.0184 18.9852 14.0493 19.0174 14.0801C19.0778 14.111 19.1241 14.1277 19.1536 14.1277H19.2475C19.3387 14.1277 19.4287 14.1431 19.5213 14.1752C19.5534 14.2035 19.5843 14.2357 19.6151 14.2665C19.6434 14.2974 19.6897 14.3282 19.7527 14.3591C19.8131 14.3873 19.8748 14.4195 19.9365 14.449C19.9674 14.449 20.0149 14.4645 20.0753 14.4966C20.1049 14.5275 20.1525 14.5429 20.2142 14.5429C20.2733 14.5737 20.335 14.6046 20.3967 14.6329C20.3967 14.665 20.4289 14.6959 20.4893 14.7254L20.5356 14.773C20.5651 14.8026 20.5973 14.8334 20.6268 14.8643C20.659 14.8938 20.6885 14.9247 20.7181 14.9568V15.0018C20.7811 15.0327 20.8261 15.0635 20.8582 15.0957C20.8891 15.1252 20.9328 15.1406 20.9958 15.1406C20.9958 15.1715 21.0253 15.2011 21.087 15.2319C21.087 15.2628 21.1012 15.2936 21.1333 15.3258C21.1642 15.3258 21.195 15.3425 21.2259 15.372C21.2567 15.4016 21.2721 15.4299 21.2721 15.462C21.3017 15.4954 21.3313 15.525 21.3634 15.5559C21.3943 15.5854 21.4251 15.6021 21.456 15.6021C21.4855 15.6317 21.5164 15.6626 21.5472 15.6921L21.5935 15.7397C21.6231 15.7705 21.6539 15.8001 21.6874 15.831C21.6874 15.8605 21.7002 15.8798 21.7311 15.8798C21.7311 15.9094 21.7478 15.9402 21.7773 15.9698C21.8082 16.0007 21.8249 16.0302 21.8249 16.0624C21.8545 16.0919 21.8686 16.1241 21.8686 16.1536L21.9162 16.2012C21.947 16.232 21.9625 16.2629 21.9625 16.2937L22.0062 16.34C22.0062 16.3709 22.0062 16.4004 22.0062 16.4313L22.055 16.4763C22.055 16.5071 22.055 16.5367 22.055 16.5676C22.0833 16.5971 22.0987 16.6293 22.0987 16.6588C22.1309 16.6897 22.1463 16.7218 22.1463 16.7527V16.7989C22.1759 16.8298 22.1913 16.8619 22.1913 16.8902V16.9378C22.2221 16.9673 22.2543 16.9982 22.2838 17.0278V17.0753C22.2838 17.1062 22.2993 17.1357 22.3314 17.1666C22.3314 17.1962 22.3314 17.2283 22.3314 17.2579C22.3314 17.29 22.3314 17.3221 22.3314 17.3504C22.361 17.3504 22.3777 17.3646 22.3777 17.3954C22.4085 17.425 22.4227 17.4571 22.4227 17.4867V17.5343C22.4535 17.5651 22.4677 17.5947 22.4677 17.6255V17.6731C22.4677 17.7027 22.4677 17.7335 22.4677 17.7631C22.4677 17.7926 22.4844 17.8261 22.5152 17.8556C22.5152 17.8878 22.5152 17.9186 22.5152 17.9495V17.9932C22.5448 18.0253 22.5615 18.0549 22.5615 18.0857L22.6065 18.132C22.6065 18.1603 22.6065 18.1937 22.6065 18.2233C22.6386 18.2233 22.6528 18.2387 22.6528 18.2696C22.6528 18.3004 22.6528 18.33 22.6528 18.3595C22.6528 18.3917 22.6695 18.4225 22.6991 18.4534V18.4997C22.6991 18.5292 22.7145 18.5614 22.7466 18.5922C22.7466 18.6218 22.7466 18.6526 22.7466 18.6848V18.7285C22.7466 18.7606 22.762 18.7902 22.7916 18.8223V18.8686C22.8225 18.8982 22.8392 18.9303 22.8392 18.9599C22.87 18.9907 22.8842 19.0216 22.8842 19.0524L22.9304 19.0974C22.9613 19.1283 22.9754 19.1591 22.9754 19.19C23.0076 19.2208 23.023 19.253 23.023 19.2825V19.3751C23.023 19.4059 23.0384 19.4368 23.0693 19.4664C23.0693 19.4985 23.0693 19.5294 23.0693 19.5589C23.0693 19.5885 23.0834 19.6219 23.1168 19.6528V19.6978C23.1464 19.7286 23.1618 19.7595 23.1618 19.7903C23.1927 19.8212 23.2094 19.8533 23.2094 19.8842V19.9279L23.2544 19.9741C23.2544 20.005 23.2544 20.0358 23.2544 20.0667C23.2544 20.0975 23.2544 20.1271 23.2544 20.158C23.2544 20.1875 23.2544 20.221 23.2544 20.2505V20.2955C23.2544 20.3276 23.2544 20.3585 23.2544 20.3881C23.284 20.4202 23.3007 20.4498 23.3007 20.4806V20.5256L23.3469 20.5732C23.3469 20.6027 23.3469 20.6323 23.3469 20.6644C23.3469 20.694 23.3469 20.7274 23.3469 20.757C23.3469 20.7853 23.3469 20.82 23.3469 20.8483V20.8946C23.3469 20.9254 23.3469 20.955 23.3469 20.9858C23.3469 21.0167 23.3469 21.0475 23.3469 21.0771V21.1697C23.3469 21.2018 23.3469 21.2326 23.3469 21.2622C23.3469 21.2943 23.3469 21.3226 23.3469 21.3548V21.401C23.3469 21.4319 23.3469 21.464 23.3469 21.4936C23.3469 21.5245 23.3469 21.554 23.3469 21.5862C23.3469 21.6157 23.3469 21.644 23.3469 21.6761V21.7687C23.3469 21.7995 23.3469 21.8317 23.3469 21.8613C23.3469 21.8921 23.3469 21.923 23.3469 21.9538V22.0001C23.3469 22.0309 23.3469 22.0605 23.3469 22.0926C23.3469 22.1222 23.3469 22.1543 23.3469 22.1852C23.3469 22.2161 23.3469 22.2456 23.3469 22.2765C23.3469 22.3073 23.3469 22.3369 23.3469 22.3677C23.3469 22.3999 23.3469 22.4307 23.3469 22.4616C23.3469 22.4924 23.3469 22.522 23.3469 22.5516V22.5978C23.3469 22.6287 23.3469 22.6596 23.3469 22.6917C23.3469 22.72 23.3469 22.7521 23.3469 22.783C23.3161 22.8151 23.3007 22.8434 23.3007 22.8755C23.2698 22.9051 23.2544 22.9346 23.2544 22.9655C23.2544 22.9976 23.2544 23.0272 23.2544 23.0593C23.2544 23.0889 23.2544 23.1198 23.2544 23.1519V23.1969C23.2544 23.2265 23.2544 23.2586 23.2544 23.2894C23.2544 23.3203 23.2544 23.3511 23.2544 23.3807C23.2544 23.4116 23.2544 23.4424 23.2544 23.472C23.2544 23.5028 23.2402 23.535 23.2094 23.5645C23.2094 23.5941 23.2094 23.625 23.2094 23.6558C23.2094 23.6867 23.1927 23.7149 23.1618 23.7484L23.1168 23.7934C23.1168 23.8229 23.1168 23.8564 23.1168 23.8859C23.1168 23.9155 23.1168 23.9463 23.1168 23.9772L23.0693 24.0248V24.0697C23.0384 24.0993 23.023 24.1314 23.023 24.1623C23.023 24.1906 23.023 24.2227 23.023 24.2549C23.023 24.2844 23.023 24.314 23.023 24.3448V24.3911C22.9921 24.4207 22.9754 24.4541 22.9754 24.4837C22.9459 24.5145 22.9304 24.5454 22.9304 24.5762L22.8842 24.6238V24.6675C22.8546 24.6984 22.8392 24.7292 22.8392 24.7601C22.8392 24.7909 22.8392 24.8218 22.8392 24.8526C22.8392 24.8822 22.8237 24.8976 22.7916 24.8976C22.7916 24.9272 22.7916 24.9606 22.7916 24.9915C22.762 25.021 22.7466 25.0519 22.7466 25.0827C22.7466 25.1136 22.7466 25.1419 22.7466 25.1727L22.6541 25.2665C22.6541 25.2961 22.6399 25.3283 22.6078 25.3591C22.6078 25.3887 22.6078 25.4208 22.6078 25.4504C22.6078 25.4812 22.5936 25.4954 22.5628 25.4954C22.5628 25.5275 22.5461 25.5584 22.5165 25.5905C22.5165 25.6201 22.5011 25.6522 22.4689 25.6831C22.4689 25.7126 22.4689 25.7435 22.4689 25.7743L22.4265 25.8219V25.8669C22.3982 25.8977 22.3648 25.9286 22.3353 25.9607C22.3353 25.9903 22.3353 26.0199 22.3353 26.0507C22.3044 26.0507 22.2877 26.0674 22.2877 26.097C22.2877 26.1291 22.2877 26.1574 22.2877 26.1895C22.2581 26.2191 22.2414 26.2487 22.2414 26.2795C22.2414 26.3104 22.226 26.3412 22.1951 26.3734V26.4209L22.1501 26.4659C22.1501 26.4955 22.136 26.5289 22.1026 26.5585C22.1026 26.588 22.1026 26.6176 22.1026 26.6497L22.0589 26.696C22.0589 26.7243 22.0447 26.7577 22.01 26.7886C22.01 26.8181 22.01 26.8477 22.01 26.8786L21.9663 26.9248C21.9355 26.9544 21.92 26.9865 21.92 27.0161L21.8725 27.0637C21.8725 27.0932 21.8583 27.1241 21.8288 27.1562C21.8288 27.1858 21.8288 27.2167 21.8288 27.2488L21.7812 27.2951C21.7812 27.3234 21.7671 27.3568 21.7349 27.3876C21.7349 27.4172 21.7195 27.4468 21.6912 27.4776C21.6912 27.5072 21.6732 27.5239 21.6437 27.5239C21.6128 27.5547 21.5974 27.5869 21.5974 27.6164C21.5974 27.6473 21.582 27.664 21.5511 27.664C21.5511 27.6923 21.537 27.7231 21.5048 27.754C21.5048 27.7848 21.4907 27.8016 21.4598 27.8016C21.4598 27.8311 21.4457 27.862 21.4135 27.8915C21.4135 27.9224 21.3981 27.9545 21.3673 27.9841C21.3351 28.015 21.3056 28.0458 21.276 28.0767V28.1229C21.2451 28.1538 21.2297 28.1834 21.2297 28.2155C21.1989 28.2463 21.168 28.2618 21.1372 28.2618C21.1372 28.2913 21.1217 28.3235 21.0909 28.353C21.0909 28.3852 21.0755 28.4019 21.0446 28.4019C21.0446 28.4302 21.0292 28.461 20.9983 28.4919C20.9983 28.5227 20.9983 28.5536 20.9983 28.5831C20.9675 28.6153 20.9353 28.6461 20.9058 28.677C20.8762 28.677 20.8454 28.6911 20.8145 28.7233C20.7837 28.7541 20.7515 28.7837 20.7207 28.8132V28.8582C20.6911 28.8891 20.6615 28.9199 20.6294 28.9521C20.6294 28.9842 20.6153 28.9996 20.5857 28.9996C20.5857 29.0292 20.5677 29.0601 20.5381 29.0896C20.5381 29.1205 20.5214 29.15 20.4918 29.1822C20.4623 29.213 20.4314 29.2439 20.3993 29.2735L20.3543 29.321C20.3234 29.3519 20.3067 29.3827 20.3067 29.4136C20.2463 29.4444 20.2 29.4586 20.1705 29.4586C20.1383 29.4907 20.1242 29.5203 20.1242 29.5524L20.0779 29.5961C20.0162 29.627 19.9699 29.6565 19.9391 29.6874C19.8774 29.7195 19.8324 29.7491 19.8015 29.7812C19.7707 29.8121 19.7411 29.8429 19.709 29.8725C19.6781 29.8725 19.6473 29.8866 19.619 29.9201C19.5881 29.9483 19.5714 29.9792 19.5714 30.0113C19.5406 30.0409 19.511 30.0563 19.4802 30.0563C19.4197 30.0872 19.3567 30.118 19.295 30.1476C19.2642 30.1476 19.2192 30.1643 19.1562 30.1952C19.0945 30.226 19.0482 30.2556 19.0199 30.2877C18.9878 30.3186 18.957 30.3481 18.9274 30.3803C18.8978 30.4124 18.867 30.4253 18.8361 30.4253C18.7731 30.4561 18.7268 30.4883 18.696 30.5178C18.6369 30.5487 18.5726 30.5808 18.5122 30.6117C18.4518 30.6399 18.4055 30.6567 18.3746 30.6567C18.3746 30.6875 18.3592 30.7171 18.3296 30.7479L18.2821 30.7942C18.2216 30.8251 18.1754 30.8559 18.1458 30.8868C18.115 30.9189 18.0828 30.933 18.052 30.933C17.9903 30.9639 17.9298 30.9806 17.8681 30.9806C17.8373 31.0102 17.8064 31.0256 17.7756 31.0256C17.7113 31.0256 17.6689 31.041 17.638 31.0719C17.5468 31.1027 17.4851 31.1349 17.4529 31.1644C17.3912 31.1953 17.3449 31.2107 17.3141 31.2107C17.2537 31.2403 17.2061 31.2557 17.1778 31.2557C17.084 31.2557 17.0081 31.2711 16.9464 31.3033C16.9156 31.3033 16.886 31.3033 16.8539 31.3033C16.7947 31.3328 16.733 31.3495 16.6726 31.3495C16.6071 31.3804 16.5466 31.3958 16.4849 31.3958C16.4258 31.4254 16.3782 31.455 16.3487 31.4871C16.2883 31.5179 16.2265 31.5475 16.1636 31.5796L16.0723 31.6246C15.9784 31.6246 15.8885 31.6246 15.7959 31.6246C15.7638 31.6555 15.7483 31.6863 15.7483 31.7172C15.7175 31.7172 15.6892 31.7172 15.6584 31.7172C15.5979 31.7493 15.5349 31.7648 15.4732 31.7648C15.4411 31.7648 15.3961 31.7789 15.3344 31.8085C15.3036 31.8085 15.274 31.8085 15.2431 31.8085C15.2123 31.8393 15.166 31.8535 15.1056 31.8535C14.9835 31.8535 14.8755 31.8702 14.7842 31.901C14.7225 31.901 14.6762 31.901 14.6467 31.901C14.6158 31.9332 14.5683 31.9473 14.5091 31.9473C14.4474 31.9473 14.3857 31.9627 14.324 31.9949H14.2764C14.2173 32.0244 14.1569 32.0399 14.0952 32.0399C14.0335 32.0399 13.9551 32.0553 13.8638 32.0849C13.8021 32.1144 13.7571 32.1324 13.7262 32.1324C13.6954 32.162 13.6491 32.1761 13.5874 32.1761C13.4344 32.1761 13.2982 32.1761 13.1735 32.1761C13.1118 32.207 13.0514 32.2365 12.9897 32.2687C12.928 32.2995 12.8817 32.3162 12.8508 32.3162C12.8213 32.3471 12.7737 32.3638 12.7133 32.3638C12.6207 32.3638 12.514 32.3792 12.3919 32.4101H12.3456C12.3161 32.4396 12.2685 32.4564 12.2068 32.4564C11.5023 32.4564 10.8094 32.4564 10.1358 32.4564C10.0729 32.4564 10.0124 32.4396 9.95073 32.4101H9.90702C9.87617 32.3792 9.84403 32.3638 9.81318 32.3638C9.72062 32.333 9.64478 32.3162 9.58179 32.3162C9.52266 32.2854 9.45967 32.2558 9.39796 32.2237C9.39796 32.1928 9.38254 32.1761 9.35168 32.1761H9.30798C9.24499 32.1478 9.17043 32.1324 9.07659 32.1324C9.04573 32.1016 8.99946 32.0707 8.94032 32.0399L8.89276 31.9949C8.83234 31.964 8.78478 31.9473 8.75521 31.9473C8.66266 31.9177 8.5701 31.901 8.47754 31.901L8.38627 31.8535H8.33999C8.24615 31.8239 8.17288 31.8085 8.11117 31.8085C8.04819 31.7789 7.98648 31.7493 7.92606 31.7172C7.86436 31.6863 7.80394 31.6555 7.74224 31.6246H7.6034C7.51084 31.5938 7.41957 31.5642 7.3283 31.5321C7.29874 31.5012 7.26531 31.4704 7.23703 31.4395H7.19076C7.0982 31.4061 7.03521 31.392 7.00564 31.392C6.91309 31.3624 6.82053 31.3303 6.73055 31.2994C6.69841 31.2994 6.66498 31.284 6.6367 31.2518H6.59043C6.49787 31.2223 6.43745 31.2069 6.4066 31.2069C6.3449 31.1773 6.26905 31.1451 6.17649 31.1143C6.14693 31.0847 6.09936 31.0552 6.03766 31.023C5.97724 31.023 5.91682 31.0076 5.85512 30.978C5.79341 30.9472 5.71628 30.9163 5.62244 30.8842C5.59288 30.8533 5.58002 30.8225 5.58002 30.7916C5.51703 30.7621 5.45533 30.7454 5.39362 30.7454C5.36277 30.7158 5.33192 30.6862 5.30107 30.6541C5.27022 30.6541 5.23936 30.6374 5.20851 30.6091C5.18023 30.5782 5.14938 30.5474 5.11853 30.5153C5.05682 30.4857 5.02597 30.4548 5.02597 30.4227C4.99512 30.4227 4.96427 30.4086 4.93341 30.3777C4.90385 30.3469 4.87171 30.3173 4.84086 30.2851C4.81258 30.253 4.78301 30.2234 4.74959 30.1926C4.71745 30.163 4.67374 30.145 4.61204 30.145C4.58119 30.1155 4.53491 30.0859 4.47577 30.0538C4.44492 30.0538 4.42821 30.0383 4.42821 30.0088C4.39736 29.9779 4.36651 29.9458 4.33694 29.9175C4.30609 29.8841 4.27395 29.8699 4.2431 29.8699C4.2431 29.8404 4.22767 29.8095 4.19811 29.7787C4.16725 29.7465 4.15054 29.717 4.15054 29.6848C4.11969 29.654 4.09012 29.6244 4.05927 29.5935C4.02971 29.564 3.99885 29.5498 3.968 29.5498C3.93715 29.5177 3.9063 29.4881 3.87673 29.456C3.84716 29.456 3.82917 29.4419 3.82917 29.411C3.76875 29.3814 3.70704 29.3493 3.64534 29.3184C3.64534 29.2876 3.62991 29.2709 3.60163 29.2709C3.57078 29.2413 3.55278 29.2105 3.55278 29.1796C3.52193 29.1475 3.49237 29.1179 3.46023 29.0871C3.43066 29.0575 3.39981 29.0266 3.36767 28.9971C3.33939 28.9971 3.30854 28.9816 3.27769 28.9495C3.27769 28.9174 3.26098 28.8878 3.23141 28.8557C3.20184 28.8557 3.1697 28.8415 3.13885 28.8107C3.13885 28.7811 3.12343 28.7515 3.09257 28.7207C3.09257 28.6886 3.07715 28.6744 3.0463 28.6744C3.0463 28.6448 3.03087 28.6127 3.00002 28.5806C2.97045 28.551 2.95503 28.5214 2.95503 28.4893C2.92417 28.4584 2.89332 28.4276 2.86118 28.3993C2.83162 28.3993 2.80077 28.3839 2.76991 28.3505C2.73906 28.3209 2.72235 28.29 2.72235 28.2592C2.6915 28.2592 2.67607 28.2438 2.67607 28.2129C2.67607 28.1821 2.67607 28.1512 2.67607 28.1204L2.63108 28.0741C2.63108 28.0445 2.63108 28.0137 2.63108 27.9815C2.60151 27.952 2.56809 27.9198 2.53852 27.889C2.53852 27.8594 2.5231 27.8286 2.49225 27.799C2.46268 27.799 2.44597 27.7823 2.44597 27.7514C2.41512 27.7219 2.40097 27.6897 2.40097 27.6614L2.3547 27.6139C2.3547 27.5843 2.33799 27.5535 2.30713 27.5213L2.21586 27.4313C2.18501 27.4005 2.15544 27.3683 2.12459 27.3388C2.12459 27.3079 2.10788 27.2771 2.07831 27.2462V27.2012C2.07831 27.1717 2.07831 27.1408 2.07831 27.1087C2.07831 27.0778 2.0616 27.0483 2.03204 27.0161C2.03204 26.9865 2.01661 26.9544 1.98576 26.9248C1.95491 26.9248 1.93948 26.9107 1.93948 26.8786C1.90863 26.8786 1.87649 26.8631 1.84821 26.8336C1.84821 26.804 1.84821 26.7719 1.84821 26.741C1.84821 26.7102 1.83278 26.6806 1.80065 26.6497V26.6035C1.80065 26.5726 1.7865 26.5418 1.75565 26.5096C1.75565 26.4801 1.74023 26.4492 1.70809 26.4196C1.70809 26.3888 1.69266 26.3721 1.6631 26.3721C1.6631 26.3399 1.6631 26.3104 1.6631 26.2782V26.232C1.6631 26.2024 1.64767 26.1703 1.61682 26.1407C1.61682 26.1111 1.61682 26.079 1.61682 26.0481C1.58468 26.0481 1.56926 26.034 1.56926 26.0019C1.56926 25.9736 1.55511 25.9427 1.52426 25.9106C1.52426 25.8797 1.52426 25.8502 1.52426 25.8193C1.52426 25.7872 1.50755 25.7718 1.4767 25.7718C1.4767 25.7422 1.4767 25.71 1.4767 25.6805C1.44713 25.6805 1.43171 25.6638 1.43171 25.6329C1.43171 25.6021 1.43171 25.5725 1.43171 25.5416L1.38543 25.4928C1.38543 25.4645 1.38543 25.4337 1.38543 25.4028C1.38543 25.372 1.37 25.3424 1.33915 25.3115C1.33915 25.2807 1.32372 25.2498 1.29416 25.2203L1.24788 25.1714C1.24788 25.1419 1.24788 25.1136 1.24788 25.0814V25.0352C1.24788 25.0056 1.23117 24.9735 1.20032 24.9439V24.8963C1.20032 24.8668 1.20032 24.8372 1.20032 24.8051C1.20032 24.7729 1.20032 24.7433 1.20032 24.7125C1.20032 24.6816 1.20032 24.6521 1.20032 24.6225C1.17203 24.6225 1.15661 24.6045 1.15661 24.5749C1.12576 24.5441 1.0949 24.5132 1.06405 24.4824V24.4361C1.06405 24.404 1.06405 24.3744 1.06405 24.3436V24.296C1.06405 24.2664 1.06405 24.2369 1.06405 24.206C1.06405 24.1752 1.06405 24.1443 1.06405 24.1122C1.06405 24.0826 1.06405 24.0517 1.06405 24.0222V23.9746C1.03449 23.9438 1.01777 23.9129 1.01777 23.8833V23.8384C0.986923 23.8075 0.971497 23.7767 0.971497 23.7458V23.6982C0.971497 23.67 0.971497 23.6391 0.971497 23.607C0.971497 23.5774 0.954785 23.5478 0.923933 23.5157V23.4681C0.923933 23.4386 0.908507 23.409 0.877655 23.3769C0.877655 23.3473 0.877655 23.3164 0.877655 23.2856V23.2393C0.877655 23.2072 0.877655 23.1776 0.877655 23.148V23.1018C0.877655 23.0709 0.877655 23.0401 0.877655 23.0105C0.877655 22.9796 0.877655 22.9475 0.877655 22.9154V22.8717C0.877655 22.8395 0.877655 22.8112 0.877655 22.7791C0.877655 22.7482 0.877655 22.7161 0.877655 22.6878V22.594C0.877655 22.5644 0.877655 22.5336 0.877655 22.5027C0.877655 22.4719 0.877655 22.4423 0.877655 22.4127C0.877655 22.3806 0.877655 22.3485 0.877655 22.3189V22.2739C0.877655 22.243 0.877655 22.2135 0.877655 22.1826C0.877655 22.1518 0.877655 22.1196 0.877655 22.0901V21.9975C0.877655 21.9679 0.877655 21.9371 0.877655 21.9062C0.877655 21.8754 0.877655 21.8458 0.877655 21.8124C0.877655 21.7816 0.877655 21.7494 0.877655 21.7198V21.6736C0.877655 21.6427 0.877655 21.6144 0.877655 21.5836C0.877655 21.5527 0.877655 21.5219 0.877655 21.491V21.3985C0.877655 21.3676 0.877655 21.3393 0.877655 21.3072C0.877655 21.2751 0.877655 21.2442 0.877655 21.2134C0.877655 21.1825 0.877655 21.1529 0.877655 21.1208V21.0732C0.877655 21.0437 0.877655 21.0128 0.877655 20.982C0.877655 20.9511 0.877655 20.9216 0.877655 20.8907V20.7994C0.877655 20.7686 0.877655 20.7377 0.877655 20.7069C0.877655 20.676 0.877655 20.6452 0.877655 20.6143C0.877655 20.5835 0.877655 20.5526 0.877655 20.5218V20.4768C0.908507 20.4459 0.923933 20.4163 0.923933 20.3842C0.923933 20.3546 0.939359 20.3238 0.971497 20.2917V20.2004C0.971497 20.1708 0.971497 20.14 0.971497 20.1091C0.971497 20.0783 0.971497 20.0487 0.971497 20.0166V19.9703C0.971497 19.9394 0.971497 19.9099 0.971497 19.8803C0.971497 19.8507 0.971497 19.8186 0.971497 19.7865C0.971497 19.7569 0.986923 19.7247 1.01777 19.6939V19.6489C1.04863 19.6489 1.06405 19.6322 1.06405 19.6013C1.06405 19.5718 1.06405 19.5409 1.06405 19.5101C1.06405 19.4792 1.06405 19.4484 1.06405 19.4188V19.3712C1.06405 19.3404 1.06405 19.3108 1.06405 19.2787C1.06405 19.2491 1.06405 19.217 1.06405 19.1861C1.0949 19.1566 1.12576 19.1257 1.15661 19.0936H1.20289C1.20289 19.0653 1.20289 19.0331 1.20289 19.0036C1.20289 18.9727 1.20289 18.9406 1.20289 18.911C1.20289 18.8815 1.20289 18.848 1.20289 18.8185V18.7722C1.20289 18.7413 1.20289 18.7105 1.20289 18.6809C1.20289 18.6501 1.2196 18.6179 1.25045 18.5884C1.25045 18.5575 1.25045 18.5254 1.25045 18.4958C1.25045 18.465 1.25045 18.4328 1.25045 18.4033C1.25045 18.3737 1.25045 18.3415 1.25045 18.312C1.28002 18.2824 1.29673 18.2516 1.29673 18.2194C1.3263 18.2194 1.34172 18.2027 1.34172 18.1744C1.37257 18.1423 1.40214 18.1114 1.43428 18.0819C1.43428 18.051 1.43428 18.0215 1.43428 17.9893C1.43428 17.9598 1.4497 17.9456 1.47927 17.9456V17.8993C1.47927 17.8672 1.47927 17.8376 1.47927 17.8055C1.47927 17.7759 1.47927 17.7438 1.47927 17.7142C1.50884 17.6847 1.52683 17.6512 1.52683 17.6204V17.5741C1.5564 17.5445 1.58597 17.5137 1.6181 17.4815C1.6181 17.452 1.63482 17.4198 1.66438 17.3903V17.3453C1.69395 17.3453 1.70937 17.3311 1.70937 17.3003C1.74023 17.2669 1.75694 17.2373 1.75694 17.209C1.78779 17.1756 1.80193 17.146 1.80193 17.1152V17.0689C1.80193 17.0381 1.80193 17.0072 1.80193 16.9763C1.83407 16.9455 1.84949 16.9159 1.84949 16.8838C1.84949 16.8555 1.84949 16.8247 1.84949 16.7925V16.7462C1.87778 16.7462 1.89577 16.7308 1.89577 16.6987C1.92534 16.6691 1.94077 16.637 1.94077 16.6074C1.97162 16.5766 2.00375 16.5457 2.03332 16.5136L2.0796 16.4686C2.0796 16.439 2.0796 16.4082 2.0796 16.3773C2.10917 16.3464 2.12588 16.3156 2.12588 16.286C2.15673 16.2552 2.1863 16.2243 2.21715 16.1935L2.30842 16.1073C2.33927 16.0778 2.35598 16.0469 2.35598 16.0161C2.38555 15.9839 2.40226 15.9531 2.40226 15.9222L2.44725 15.8785C2.4781 15.8464 2.49353 15.813 2.49353 15.7834C2.52438 15.7538 2.53981 15.723 2.53981 15.6908C2.56938 15.6613 2.6028 15.6317 2.63237 15.6009C2.66193 15.6009 2.67736 15.5841 2.67736 15.5546C2.70821 15.5546 2.74035 15.5379 2.7712 15.5083C2.80077 15.4774 2.83162 15.4466 2.86247 15.4145C2.89332 15.3849 2.92546 15.354 2.95631 15.3245L3.0013 15.2782C3.03216 15.2461 3.04758 15.2152 3.04758 15.1831C3.07843 15.1548 3.11057 15.1239 3.14014 15.0931C3.17099 15.0622 3.20313 15.0314 3.23269 14.9992C3.26226 14.9992 3.27897 14.9838 3.27897 14.9543C3.30982 14.9543 3.34068 14.9375 3.36896 14.9093C3.39981 14.8771 3.43066 14.8463 3.46151 14.8141C3.49237 14.7859 3.52322 14.7537 3.55407 14.7229L3.60035 14.6804C3.62863 14.6509 3.64406 14.6187 3.64406 14.5892C3.67619 14.5583 3.70576 14.5288 3.73533 14.4966C3.76618 14.4658 3.79832 14.449 3.82788 14.449C3.82788 14.4195 3.84588 14.3873 3.87545 14.3591C3.93586 14.3591 3.99757 14.3411 4.05799 14.3115C4.08884 14.2819 4.11841 14.2511 4.14926 14.2202C4.1814 14.1881 4.22767 14.1598 4.28938 14.1277C4.34851 14.1277 4.39607 14.1277 4.42693 14.1277C4.45778 14.1277 4.50277 14.1277 4.56576 14.1277C4.59533 14.0981 4.62489 14.0673 4.65575 14.0351C4.71616 14.0056 4.78172 13.9734 4.83957 13.9413C4.93213 13.9117 4.99512 13.8821 5.02597 13.85C5.08639 13.85 5.14938 13.8372 5.20851 13.8063C5.27022 13.7742 5.34735 13.76 5.4399 13.76C5.47075 13.76 5.50161 13.7446 5.53246 13.7125H5.58002C5.64044 13.6829 5.69957 13.6675 5.76128 13.6675C5.8217 13.6353 5.86926 13.6186 5.90011 13.6186C5.96053 13.589 6.02095 13.5736 6.08265 13.5736C6.14564 13.5736 6.19063 13.5736 6.22149 13.5736C6.28319 13.5736 6.34361 13.5582 6.40531 13.5286H6.45159C6.5133 13.4978 6.57371 13.4811 6.63542 13.4811C6.75883 13.4515 6.89638 13.4374 7.04935 13.4374C7.08149 13.4052 7.12777 13.3744 7.18947 13.3448C7.2486 13.3448 7.31159 13.3294 7.3733 13.2985C7.40286 13.2664 7.43372 13.251 7.46457 13.251C7.52627 13.251 7.57255 13.2342 7.6034 13.2047L7.64968 13.1584C7.71267 13.1584 7.7718 13.1584 7.83351 13.1584C8.11117 13.1584 8.4017 13.1443 8.70765 13.1134C8.7385 13.1134 8.77064 13.1134 8.8002 13.1134C8.83106 13.1134 8.87605 13.1134 8.93904 13.1134V13.0684C9.09073 13.0684 9.24242 13.0684 9.39668 13.0684V12.9322C9.39668 12.9013 9.39668 12.8717 9.39668 12.8396C9.39668 12.81 9.39668 12.7779 9.39668 12.747V12.7008C9.39668 12.6699 9.39668 12.6391 9.39668 12.6095C9.39668 12.5786 9.39668 12.5478 9.39668 12.5169C9.39668 12.4874 9.39668 12.4565 9.39668 12.4244V12.3344C9.39668 12.3023 9.39668 12.2714 9.39668 12.2406C9.39668 12.2084 9.39668 12.1776 9.39668 12.148V12.1017C9.39668 12.0722 9.39668 12.0413 9.39668 12.0092C9.39668 11.9796 9.39668 11.95 9.39668 11.9179C9.39668 11.887 9.39668 11.8562 9.39668 11.8253V11.7328C9.39668 11.7032 9.39668 11.6711 9.39668 11.6415C9.39668 11.6094 9.39668 11.5798 9.39668 11.549V11.5014C9.39668 11.4718 9.39668 11.441 9.39668 11.4101C9.39668 11.3793 9.39668 11.3497 9.39668 11.3163C9.36711 11.2867 9.3504 11.2571 9.3504 11.2263V11.135C9.3504 11.1055 9.3504 11.0733 9.3504 11.0438C9.3504 11.0129 9.3504 10.9821 9.3504 10.9499V10.9049C9.3504 10.8741 9.3504 10.8419 9.3504 10.8124C9.3504 10.7828 9.3504 10.7507 9.3504 10.7198V10.6735C9.3504 10.6427 9.3504 10.6118 9.3504 10.581V10.5347C9.22699 10.5347 9.10487 10.5347 8.98275 10.5347C8.98275 10.5051 8.96603 10.4743 8.93775 10.4434C8.93775 10.4151 8.93775 10.383 8.93775 10.3534C8.93775 10.3213 8.93775 10.2917 8.93775 10.2596C8.9069 10.2596 8.85934 10.2596 8.79892 10.2596C8.79892 10.2275 8.79892 10.1992 8.79892 10.1683V10.0758C8.79892 10.0449 8.79892 10.0154 8.79892 9.9845C8.79892 9.95236 8.79892 9.92151 8.79892 9.89066V9.75182C8.79892 9.72226 8.79892 9.69398 8.79892 9.66055C8.79892 9.63099 8.79892 9.60014 8.79892 9.57185V9.15664C8.79892 9.12579 8.79892 9.09622 8.79892 9.06537C8.79892 9.03452 8.79892 9.00366 8.79892 8.97281V8.92653C8.79892 8.89568 8.79892 8.86354 8.79892 8.83398C8.79892 8.80312 8.79892 8.77099 8.79892 8.74142C8.79892 8.71185 8.79892 8.67843 8.79892 8.65015V8.55888C8.79892 8.52931 8.79892 8.49717 8.79892 8.46632C8.79892 8.43547 8.79892 8.40462 8.79892 8.37505V8.32877C8.79892 8.29535 8.79892 8.26579 8.79892 8.23493C8.79892 8.2028 8.79892 8.17451 8.79892 8.14366C8.79892 8.11281 8.79892 8.08067 8.79892 8.04982V7.95855C8.79892 7.92898 8.79892 7.89685 8.79892 7.86728C8.79892 7.83643 8.79892 7.80686 8.79892 7.77601V7.73102C8.79892 7.70016 8.79892 7.66803 8.79892 7.63717C8.79892 7.60632 8.79892 7.57547 8.79892 7.54462C8.79892 7.51377 8.79892 7.48291 8.79892 7.45206V7.36079C8.79892 7.32994 8.79892 7.29909 8.79892 7.26952C8.79892 7.23867 8.79892 7.20653 8.79892 7.17696V7.13197C8.79892 7.09983 8.79892 7.07027 8.79892 7.03942C8.79892 7.00856 8.79892 6.97771 8.79892 6.94686C8.79892 6.91729 8.79892 6.88644 8.79892 6.8543V6.76303C8.79892 6.72961 8.79892 6.70004 8.79892 6.67048C8.79892 6.63963 8.79892 6.60877 8.79892 6.57921V6.53293C8.79892 6.50208 8.79892 6.46994 8.79892 6.44037C8.79892 6.40952 8.79892 6.37867 8.79892 6.34782V6.30411C8.79892 6.27197 8.79892 6.23855 8.79892 6.20898V6.16399C8.79892 6.13185 8.79892 6.101 8.79892 6.07143V6.02515C8.79892 5.9943 8.79892 5.96345 8.79892 5.93388C8.79892 5.90175 8.79892 5.87089 8.79892 5.84133C8.79892 5.81176 8.79892 5.78091 8.79892 5.74877V5.70249C8.79892 5.67036 8.79892 5.64079 8.79892 5.60994V5.56366C8.79892 5.53281 8.79892 5.50196 8.79892 5.4711V5.42611C8.79892 5.39397 8.79892 5.36312 8.79892 5.33356C8.79892 5.3027 8.79892 5.27185 8.79892 5.241C8.79892 5.21272 8.79892 5.18187 8.79892 5.14973V5.10345C8.79892 5.07388 8.79892 5.04303 8.79892 5.01218V4.9659C8.79892 4.93505 8.79892 4.90548 8.79892 4.87334V4.82964C8.79892 4.79879 8.79892 4.76665 8.79892 4.73708C8.79892 4.70623 8.79892 4.67666 8.79892 4.64581C8.79892 4.61624 8.79892 4.58411 8.79892 4.55325V4.50569C8.79892 4.47613 8.79892 4.44527 8.79892 4.41442V4.36814C8.79892 4.33986 8.79892 4.30901 8.79892 4.27559V4.23059C8.49168 4.23059 8.19987 4.2473 7.92349 4.27559C7.86179 4.27559 7.81679 4.27559 7.78594 4.27559C7.7281 4.30772 7.66511 4.32186 7.6034 4.32186H7.55841C7.49542 4.32186 7.44914 4.32186 7.42086 4.32186C7.35787 4.29358 7.28074 4.27559 7.19076 4.27559C7.12905 4.27559 7.08406 4.26145 7.05064 4.23059C6.9915 4.19974 6.91309 4.1676 6.82053 4.13804C6.78968 4.10847 6.77425 4.07762 6.77425 4.04805C6.74469 4.0172 6.71255 3.98763 6.68298 3.95421C6.65084 3.95421 6.6367 3.93879 6.6367 3.90793C6.60457 3.87837 6.59043 3.84751 6.59043 3.81538V3.77038C6.55957 3.73953 6.54543 3.70739 6.54543 3.67911V3.63283C6.54543 3.59941 6.54543 3.56985 6.54543 3.53899C6.54543 3.51071 6.54543 3.47858 6.54543 3.44772C6.54543 3.41816 6.55957 3.40145 6.59171 3.40145C6.59171 3.37188 6.59171 3.34103 6.59171 3.31017C6.59171 3.28061 6.60585 3.25104 6.63799 3.21762L6.68427 3.17134C6.71255 3.14306 6.74469 3.11092 6.77425 3.08007L6.82053 3.03379C6.88223 3.00294 6.94394 2.98623 7.00564 2.98623H7.05064V2.94252C7.05064 2.91167 7.05064 2.8821 7.05064 2.84997V2.8024C7.05064 2.77283 7.05064 2.74198 7.05064 2.71242C7.05064 2.68028 7.05064 2.65328 7.05064 2.61729V2.57358L7.0982 2.5273C7.12905 2.49774 7.15862 2.46688 7.19076 2.43603C7.22032 2.40647 7.23703 2.37433 7.23703 2.34348C7.26403 2.31134 7.29745 2.28177 7.32702 2.24964C7.32702 2.22007 7.34244 2.20207 7.3733 2.20207C7.40286 2.17379 7.43372 2.14294 7.46457 2.11209C7.52627 2.11209 7.57255 2.09795 7.6034 2.06709L7.64968 2.02082C7.71267 2.02082 7.7718 2.02082 7.83351 2.02082C8.04819 2.02082 8.26286 2.02082 8.47754 2.02082V1.97454C8.50839 1.94369 8.53925 1.92826 8.57138 1.92826C8.59967 1.89869 8.63052 1.86784 8.66266 1.83699C8.72307 1.83699 8.77064 1.82285 8.8002 1.792V1.74572C8.8002 1.71487 8.8002 1.68401 8.8002 1.65445C11.0704 1.65445 13.3277 1.65445 15.5671 1.65445V1.60688C15.5671 1.57603 15.5671 1.54518 15.5671 1.51304C15.5671 1.48476 15.5671 1.45262 15.5671 1.42306C15.5671 1.39092 15.5671 1.36135 15.5671 1.33179V1.28551C15.5671 1.25466 15.5671 1.2238 15.5671 1.19295C15.5671 1.16081 15.5671 1.13125 15.5671 1.1004V1.00784C15.5671 0.976989 15.5671 0.947422 15.5671 0.91657C15.5671 0.884432 15.5671 0.85358 15.5671 0.824014V0.777735C15.5671 0.748169 15.5671 0.718603 15.5671 0.687751C15.5671 0.658184 15.5671 0.627332 15.5671 0.59648V0.547631C15.5992 0.516779 15.6455 0.501353 15.7059 0.501353V0.45636C16.1044 0.45636 16.5042 0.45636 16.9027 0.45636V0.501353C16.9027 0.532205 16.9027 0.563057 16.9027 0.595194C16.9027 0.624761 16.9027 0.656899 16.9027 0.686465C16.9027 0.717317 16.9027 0.746883 16.9027 0.77645L16.949 0.824014C16.949 0.85358 16.949 0.883147 16.949 0.91657C16.9799 0.946136 16.9953 0.975703 16.9953 1.00784L17.0416 1.05412V1.1004C17.0724 1.13125 17.0865 1.16081 17.0865 1.19295C17.0865 1.2238 17.0865 1.25466 17.0865 1.28551C17.0865 1.31379 17.0724 1.33179 17.0416 1.33179C17.0416 1.36135 17.0416 1.39092 17.0416 1.42306C17.0107 1.45262 16.9953 1.48348 16.9953 1.51304C16.9644 1.54389 16.949 1.57475 16.949 1.60688V1.69944C16.949 1.72901 16.949 1.75857 16.949 1.792C17.0107 1.792 17.0724 1.792 17.1328 1.792C17.165 1.82156 17.1958 1.85242 17.2241 1.88198C17.2562 1.91412 17.2858 1.92826 17.3179 1.92826C17.3475 1.95911 17.3642 1.98996 17.3642 2.0221C17.3951 2.0221 17.4259 2.03881 17.4568 2.06838C17.4876 2.09923 17.5031 2.1288 17.5031 2.15965L17.5506 2.20336C17.5802 2.23421 17.5956 2.26763 17.5956 2.2972C17.6265 2.32805 17.6432 2.3589 17.6432 2.39104V2.43732C17.674 2.46817 17.6882 2.49902 17.6882 2.52859V2.57487C17.6882 2.607 17.6882 2.63786 17.6882 2.66614C17.6882 2.6957 17.674 2.72656 17.6432 2.75741V2.8024H17.6882C17.6882 2.83325 17.7036 2.86539 17.7332 2.89496C17.7332 2.92452 17.7332 2.95795 17.7332 2.98623C17.764 3.01708 17.7807 3.04793 17.7807 3.08007L17.8257 3.12635C17.8257 3.1572 17.8257 3.18934 17.8257 3.2189C17.8257 3.25233 17.8257 3.28061 17.8257 3.31146C17.8566 3.34231 17.8733 3.37316 17.8733 3.40273H17.9196C17.9491 3.4323 17.9645 3.46443 17.9645 3.494C17.9954 3.494 18.0275 3.512 18.0571 3.54028C18.088 3.57113 18.1034 3.6007 18.1034 3.63412L18.1509 3.67911C18.1805 3.70868 18.1959 3.74082 18.1959 3.77038L18.2435 3.81666C18.2435 3.84751 18.2435 3.87837 18.2435 3.90793L18.2885 3.95421C18.2885 3.98763 18.2885 4.0172 18.2885 4.04805C18.2885 4.07762 18.3039 4.10847 18.3361 4.13804C18.3361 4.1676 18.3361 4.19974 18.3361 4.23059L18.381 4.27559C18.381 4.30772 18.381 4.33986 18.381 4.36814L18.426 4.41442C18.426 4.44527 18.426 4.47613 18.426 4.50569L18.4736 4.55325C18.4736 4.58411 18.489 4.61496 18.5186 4.64581C18.5186 4.67666 18.5186 4.70623 18.5186 4.73708C18.5495 4.76665 18.579 4.79879 18.6112 4.82964C18.642 4.82964 18.6587 4.84635 18.6587 4.87463C18.687 4.90677 18.7024 4.93633 18.7024 4.96719V5.01346C18.7024 5.04432 18.7024 5.07517 18.7024 5.10474L18.75 5.15101C18.7796 5.18187 18.8104 5.214 18.8425 5.24228C18.8425 5.27185 18.8567 5.3027 18.8888 5.33484C18.8888 5.36441 18.9042 5.39526 18.9338 5.4274V5.47239C18.9634 5.50324 18.9801 5.53409 18.9801 5.56494V5.61122C19.0109 5.64208 19.0264 5.67164 19.0264 5.70378C19.0547 5.70378 19.0868 5.7192 19.1164 5.75006C19.1164 5.78091 19.1164 5.81305 19.1164 5.84261C19.1472 5.87218 19.1626 5.90303 19.1626 5.93517C19.1626 5.96474 19.1626 5.99559 19.1626 6.02644C19.1935 6.02644 19.2102 6.04315 19.2102 6.07272C19.2411 6.101 19.2565 6.13314 19.2565 6.16527V6.21027C19.2565 6.23983 19.2706 6.27326 19.3015 6.30539L19.3477 6.3491C19.3477 6.37995 19.3632 6.41081 19.3966 6.44166C19.3966 6.46994 19.4095 6.50208 19.439 6.53421V6.58049C19.4712 6.61006 19.4879 6.64091 19.4879 6.67176C19.5174 6.70133 19.5329 6.7309 19.5329 6.76432L19.5791 6.80803C19.5714 6.83888 19.5881 6.8543 19.6203 6.8543ZM2.26343 20.203C2.26343 20.1734 2.26343 20.1425 2.26343 20.1117C2.26343 20.0808 2.26343 20.0513 2.26343 20.0191V19.9728L2.21715 20.0191C2.21715 20.05 2.21715 20.0808 2.21715 20.1117C2.1863 20.1425 2.17216 20.1734 2.17216 20.203V20.2942C2.17216 20.3264 2.17216 20.3572 2.17216 20.3868C2.17216 20.4163 2.17216 20.4485 2.17216 20.4793C2.17216 20.4485 2.18758 20.4163 2.21715 20.3868C2.21715 20.3572 2.21715 20.3264 2.21715 20.2942C2.24929 20.2942 2.26343 20.2801 2.26343 20.2492V20.203Z" fill="white"/>
</svg>
]]

local function load_weapon_icons()
    if icons_loaded then return end
    icons_loaded = true
    

    local icon_data = {
        ["weapon_smokegrenade"] = SVG_SMOKE,
        ["weapon_hegrenade"]    = SVG_HE,
        ["weapon_molotov"]      = SVG_MOLOTOV,
        ["weapon_incgrenade"]   = SVG_MOLOTOV
    }
    
    for wep_name, svg_str in pairs(icon_data) do
        local ok, tex, sz = pcall(render.create_svg_from_memory, svg_str, 0.8)
        if ok and tex then
            weapon_icons[wep_name] = {texture = tex, size = sz}
        end
    end
    

    weapon_icons["weapon_flashbang"] = nil
end

local DATA_FOLDER = utils.get_game_path() .. "/grenade_helper"
local DATA_FILE = DATA_FOLDER .. "/locations.json"

local WEAPONS = {
    ["weapon_smokegrenade"] = {name = "Smoke", col = color(180, 180, 180, 255)},
    ["weapon_flashbang"] = {name = "Flash", col = color(255, 255, 100, 255)},
    ["weapon_hegrenade"] = {name = "HE", col = color(255, 100, 100, 255)},
    ["weapon_molotov"] = {name = "Molotov", col = color(255, 150, 50, 255)},
    ["weapon_incgrenade"] = {name = "Incendiary", col = color(255, 150, 50, 255)}
}

local WEAPON_LIST = {"Smoke", "Flash", "HE", "Molotov"}
local WEAPON_KEYS = {"weapon_smokegrenade", "weapon_flashbang", "weapon_hegrenade", "weapon_molotov"}
local STRENGTH_NAMES = {"Left", "Both", "Right"}
local STRENGTH_VALUES = {1, 0.5, 0}
local RUN_NAMES = {"Disabled", "Forward", "Left", "Right", "Back", "Custom"}
local RUN_VALUES = {0, 1, 2, 3, 4, 5} 
local RECOVERY_NAMES = {"Disabled", "Forward", "Left", "Right", "Back", "Custom"}

local sources_list = {"default"} 
local current_source = "default" 
local locations_data = {}        
local current_map = ""
local active_loc = nil
local editing_loc = nil
local editing_index = -1
local throw_data = {active = false, tick = 0, stage = 0, loc = nil}

local editor_pos = {0, 0, 0}
local editor_ang = {0, 0}

local anim_state = {}

local search_filter = ""
local show_all_maps = false

local delete_confirm_mode = false
local delete_loc_confirm_mode = false

local json = {}

local function enc(v)
    local t = type(v)
    if t == "nil" then return "null"
    elseif t == "boolean" then return v and "true" or "false"
    elseif t == "number" then
        if v ~= v then return "null" end
        return string.format("%.14g", v)
    elseif t == "string" then
        return '"' .. v:gsub('[\\"\n\r\t]', {['\\']='\\\\', ['"']='\\"', ['\n']='\\n', ['\r']='\\r', ['\t']='\\t'}) .. '"'
    elseif t == "table" then
        local is_arr, n = true, 0
        for k in pairs(v) do
            if type(k) ~= "number" or k < 1 or k ~= math.floor(k) then is_arr = false break end
            if k > n then n = k end
        end
        local p = {}
        if is_arr and n > 0 then
            for i = 1, n do p[i] = enc(v[i]) end
            return "[" .. table.concat(p, ",") .. "]"
        else
            for k, val in pairs(v) do p[#p+1] = enc(tostring(k)) .. ":" .. enc(val) end
            return "{" .. table.concat(p, ",") .. "}"
        end
    end
    return "null"
end
json.encode = enc

local function dec(s, i)
    i = i or 1
    while i <= #s and s:sub(i,i):match("%s") do i = i + 1 end
    local c = s:sub(i, i)
    if c == '"' then
        local j = i + 1
        while j <= #s do
            local ch = s:sub(j, j)
            if ch == '\\' then j = j + 2
            elseif ch == '"' then
                return s:sub(i+1, j-1):gsub('\\(.)', {n='\n',r='\r',t='\t',['"']='"',['\\']='\\'}), j + 1
            else j = j + 1 end
        end
    elseif c == '{' then
        local obj = {}
        i = i + 1
        while i <= #s do
            while s:sub(i,i):match("%s") do i = i + 1 end
            if s:sub(i,i) == '}' then return obj, i + 1 end
            if s:sub(i,i) == ',' then i = i + 1 end
            while s:sub(i,i):match("%s") do i = i + 1 end
            local k, v
            k, i = dec(s, i)
            while s:sub(i,i):match("[%s:]") do i = i + 1 end
            v, i = dec(s, i)
            obj[k] = v
        end
    elseif c == '[' then
        local arr = {}
        i = i + 1
        while i <= #s do
            while s:sub(i,i):match("%s") do i = i + 1 end
            if s:sub(i,i) == ']' then return arr, i + 1 end
            if s:sub(i,i) == ',' then i = i + 1 end
            local v
            v, i = dec(s, i)
            arr[#arr + 1] = v
        end
    elseif s:sub(i, i+3) == "true" then return true, i + 4
    elseif s:sub(i, i+4) == "false" then return false, i + 5
    elseif s:sub(i, i+3) == "null" then return nil, i + 4
    else
        local num = s:match("^%-?%d+%.?%d*[eE]?[+-]?%d*", i)
        if num then return tonumber(num), i + #num end
    end
    return nil, i
end
function json.decode(s)
    if not s or s == "" then return nil end
    return (dec(s, 1))
end

local function get_loc_desc(loc)
    if not loc then return "" end
    if type(loc.description) == "table" then
        return loc.description[2] or loc.description[1] or ""
    end
    return loc.description or ""
end

local BUILTIN_LOCATIONS = nil 


local function get_source_file(name)
    return DATA_FOLDER .. "/" .. name .. ".json"
end

local function load_sources()
    utils.create_folder(DATA_FOLDER)

    local idx = utils.read_file(DATA_FOLDER .. "/sources.txt")
    if idx and idx ~= "" then
        sources_list = {}
        for s in idx:gmatch("[^\n]+") do
            if s ~= "" then sources_list[#sources_list + 1] = s end
        end
    end
    if #sources_list == 0 then
        sources_list = {"default"}
    end
end

local function save_sources()
    utils.create_folder(DATA_FOLDER)
    utils.write_file(DATA_FOLDER .. "/sources.txt", table.concat(sources_list, "\n"), true)
end

local function load_data()
    utils.create_folder(DATA_FOLDER)
    local c = utils.read_file(get_source_file(current_source))
    local raw_data = c and json.decode(c) or {}

    locations_data = normalize_map_data(raw_data)
    

    if BUILTIN_LOCATIONS and current_source == "default" and not next(locations_data) then
        local builtin = json.decode(BUILTIN_LOCATIONS)
        if builtin then
            local count = 0
            locations_data = normalize_map_data(builtin)
            for _, locs in pairs(locations_data) do count = count + #locs end
            if count > 0 then
                save_data()
                utils.console_print(color(100, 255, 100, 255), "[GH] Auto-imported " .. count .. " built-in locations\n")
            end
        end
    end
end

local function save_data()
    utils.create_folder(DATA_FOLDER)
    utils.write_file(get_source_file(current_source), json.encode(locations_data), true)
end

local function get_locs()
    return current_map ~= "" and locations_data[current_map] or {}
end


local function get_loc_name(loc)
    if not loc then return "?" end
    local name = loc.name
    if type(name) == "table" then
    
        return name[2] or name[1] or "?"
    elseif type(name) == "string" then
        return name
    else
        return "?"
    end
end

local function normalize_location(loc)
    if not loc then return nil end
    

    local name = loc.name
    if type(name) == "table" then
    
    
        if type(name[2]) == "string" and name[2] ~= "" then
            loc.name = name[2]
        elseif type(name[1]) == "string" and name[1] ~= "" then
            loc.name = name[1]
        else
            loc.name = "Unnamed"
        end
    elseif type(name) ~= "string" or name == "" then
        loc.name = "Unnamed"
    end
    

    if type(loc.position) ~= "table" or #loc.position < 3 then
        return nil 
    end

    if type(loc.position[1]) ~= "number" or type(loc.position[2]) ~= "number" or type(loc.position[3]) ~= "number" then
        return nil
    end
    

    if type(loc.viewangles) ~= "table" or #loc.viewangles < 2 then
        return nil 
    end

    if type(loc.viewangles[1]) ~= "number" or type(loc.viewangles[2]) ~= "number" then
        return nil
    end
    

    if type(loc.grenade) ~= "table" then
        loc.grenade = {}
    end
    


    local g = loc.grenade
    if g.run == nil or g.run == false then
        g.run = 0 
    elseif g.run == true then
        if g.run_yaw == nil then
            g.run = 1 
        else
        
            local yaw = g.run_yaw
            if yaw == 0 then g.run = 1     
            elseif yaw == 90 then g.run = 2 
            elseif yaw == -90 or yaw == 270 then g.run = 3 
            elseif yaw == 180 or yaw == -180 then g.run = 4 
            else
                g.run = 5 
                g.run_custom = yaw
            end
        end
    end
    

    if g.recovery == nil or g.recovery == false then
        g.recovery = 0
    elseif g.recovery == true then
        if g.recovery_yaw == nil then
            g.recovery = 1 
        else
            local yaw = g.recovery_yaw
            if yaw == 0 then g.recovery = 1
            elseif yaw == 90 then g.recovery = 2
            elseif yaw == -90 or yaw == 270 then g.recovery = 3
            elseif yaw == 180 or yaw == -180 then g.recovery = 4
            else
                g.recovery = 5
                g.recovery_custom = yaw
            end
        end
    end
    

    if g.run_speed ~= nil then
        g.run_walk = not g.run_speed 
    end
    

    if loc.duck == nil then
        loc.duck = false
    end
    

    if type(loc.description) ~= "string" then
        loc.description = ""
    end
    
    return loc
end

local function normalize_map_data(map_data)
    if type(map_data) ~= "table" then return {} end
    
    local normalized = {}
    for map_name, locs in pairs(map_data) do
        if type(locs) == "table" then
            normalized[map_name] = {}
            for i, loc in ipairs(locs) do
                local norm_loc = normalize_location(loc)
                if norm_loc then
                    normalized[map_name][#normalized[map_name] + 1] = norm_loc
                end
            end
        end
    end
    return normalized
end

local container = ui.find_container("Scripting, Script elements")

local ui_enabled = container:add_checkbox("Helper")
local ui_color = ui_enabled:add_color_picker()
ui_color:set(color(100, 200, 255, 255))
local ui_throw_key = ui_enabled:add_hotkey()

local ui_silent = container:add_checkbox("Silent Aim")
ui_silent:set(true)

local ui_fov = container:add_slider("Field of View", 40, 180, 1, "")
ui_fov:set(100)

local ui_options = container:add_multi_dropdown("Options", {
    "Automatic Throw",     
    "Show Behind Walls",   
    "Hide Duplicates",     
    "Hide Icon With Text", 
    "Info Panel",          
    "Aim Indicator",       
    "Auto Duck",           
    "Auto Jump",           
    "Auto Run",            
    "Debug"                
})
ui_options:set({false, false, false, false, true, true, true, true, true, false})

local ui_types = container:add_multi_dropdown("Types", {"Smoke", "Flash", "HE", "Molotov"})
ui_types:set({true, true, true, true})

local function opt_auto_throw() return ui_options:get()[1] end
local function opt_show_behind() return ui_options:get()[2] end
local function opt_hide_duplicates() return ui_options:get()[3] end
local function opt_hide_icon() return ui_options:get()[4] end
local function opt_info_panel() return ui_options:get()[5] end
local function opt_aim_ind() return ui_options:get()[6] end
local function opt_auto_duck() return ui_options:get()[7] end
local function opt_auto_jump() return ui_options:get()[8] end
local function opt_auto_run() return ui_options:get()[9] end
local function opt_debug() return ui_options:get()[10] end

local function passes_type_filter(wep)
    local sel = ui_types:get()
    if wep == "weapon_smokegrenade" then return sel[1] end
    if wep == "weapon_flashbang" then return sel[2] end
    if wep == "weapon_hegrenade" then return sel[3] end
    if wep == "weapon_molotov" or wep == "weapon_incgrenade" then return sel[4] end
    return false
end

container:add_seperator()


local ui_active_source = container:add_list_box("Active Sources", sources_list, 60)

local edit_source_opts = {"None"}
for _, s in ipairs(sources_list) do edit_source_opts[#edit_source_opts + 1] = s end
local ui_edit_source = container:add_list_box("Editing Source", edit_source_opts, 60)

local ui_source_name = container:add_text_box("Source Name")
local ui_btn_create_src = container:add_button("Create Source", function() end)

container:add_seperator()

local edit_elements = {}

local function refresh_sources()

    ui_active_source:set_options(sources_list)
    for i, s in ipairs(sources_list) do
        if s == current_source then
            ui_active_source:set(i - 1)
            break
        end
    end
    

    local opts = {"None"}
    for _, s in ipairs(sources_list) do opts[#opts + 1] = s end
    ui_edit_source:set_options(opts)
end

local function update_edit_visibility()
    local idx = ui_edit_source:get_index()
    local show = idx > 0 
    for _, el in ipairs(edit_elements) do
        el:set_visibility(show)
    end
end

local function switch_active_source()
    local idx = ui_active_source:get_index() + 1
    if idx >= 1 and idx <= #sources_list then
        current_source = sources_list[idx]
        load_data()
        refresh_list()
    end
end
ui_active_source:add_callback(switch_active_source)

ui_edit_source:add_callback(function()
    local idx = ui_edit_source:get_index()
    if idx > 0 then
    
        local src = sources_list[idx]
        if src then
            current_source = src
            load_data()
            refresh_list()
        
            ui_active_source:set(idx - 1)
        end
    end
    update_edit_visibility()
end)

local function btn_create_source()
    local name = ui_source_name:get()
    if name == "" then
        name = "source_" .. math.floor(globals.get_real_time())
    end

    for _, s in ipairs(sources_list) do
        if s == name then
            utils.console_print(color(255, 100, 100, 255), "[GH] Source already exists: " .. name .. "\n")
            return
        end
    end
    sources_list[#sources_list + 1] = name
    save_sources()
    current_source = name
    locations_data = {}
    save_data()
    refresh_sources()
    refresh_list()
    utils.console_print(color(100, 255, 100, 255), "[GH] Created source: " .. name .. "\n")
end

local function btn_import_source()
    local clip = input.get_clipboard()
    if not clip or clip == "" then
        utils.console_print(color(255, 100, 100, 255), "[GH] Empty clipboard\n")
        return
    end
    local data = json.decode(clip)
    if not data then
        utils.console_print(color(255, 100, 100, 255), "[GH] Invalid JSON\n")
        return
    end

    local count = 0
    if data.name and data.weapon and data.position then
    
        normalize_location(data)
        if current_map ~= "" then
            if not locations_data[current_map] then locations_data[current_map] = {} end
            locations_data[current_map][#locations_data[current_map] + 1] = data
            count = 1
        end
    else
    
        for map, locs in pairs(data) do
            if type(locs) == "table" then
                if not locations_data[map] then locations_data[map] = {} end
                for _, loc in ipairs(locs) do
                    normalize_location(loc) 
                    locations_data[map][#locations_data[map] + 1] = loc
                    count = count + 1
                end
            end
        end
    end
    save_data()
    refresh_list()
    utils.console_print(color(100, 255, 100, 255), "[GH] Imported " .. count .. " to " .. current_source .. "\n")
end

local function btn_import_file()
    local filename = ui_import_filename:get()
    if filename == "" then
        utils.console_print(color(255, 100, 100, 255), "[GH] Enter a filename (without .json)\n")
        return
    end
    local path = DATA_FOLDER .. "/" .. filename .. ".json"
    local c = utils.read_file(path)
    if not c or c == "" then
        utils.console_print(color(255, 100, 100, 255), "[GH] File not found: " .. path .. "\n")
        return
    end
    local data = json.decode(c)
    if not data then
        utils.console_print(color(255, 100, 100, 255), "[GH] Invalid JSON in file\n")
        return
    end
    local count = 0
    for map, locs in pairs(data) do
        if type(locs) == "table" then
            if not locations_data[map] then locations_data[map] = {} end
            for _, loc in ipairs(locs) do
                normalize_location(loc)
                locations_data[map][#locations_data[map] + 1] = loc
                count = count + 1
            end
        end
    end
    save_data()
    refresh_list()
    utils.console_print(color(100, 255, 100, 255), "[GH] Imported " .. count .. " locations from " .. filename .. ".json\n")
end

local function btn_export_source()
    if not next(locations_data) then
        utils.console_print(color(255, 100, 100, 255), "[GH] Source is empty\n")
        return
    end
    input.set_clipboard(json.encode(locations_data))
    local c = 0
    for _, v in pairs(locations_data) do c = c + #v end
    utils.console_print(color(100, 255, 100, 255), "[GH] Exported " .. c .. " locations from " .. current_source .. "\n")
end

local function btn_delete_source()
    if current_source == "default" then
        utils.console_print(color(255, 100, 100, 255), "[GH] Cannot delete default source\n")
        return
    end

    for i, s in ipairs(sources_list) do
        if s == current_source then
            table.remove(sources_list, i)
            break
        end
    end
    save_sources()

    current_source = "default"
    load_data()
    refresh_sources()
    refresh_list()
    utils.console_print(color(255, 200, 100, 255), "[GH] Deleted source, switched to default\n")
end

ui_btn_create_src:add_callback(btn_create_source)


local ui_lbl_locations = container:add_label("Locations")

local ui_search = container:add_text_box("Search")
ui_search:add_tooltip("Filter locations by name")

local ui_all_maps = container:add_checkbox("All Maps")
ui_all_maps:add_tooltip("Show locations from all maps")

local ui_list = container:add_list_box("", {}, 100, true)

local function get_filtered_locs()
    local result = {}
    local search_text = ui_search:get():lower()
    
    if ui_all_maps:get() then
    
        for map_name, locs in pairs(locations_data) do
            for i, loc in ipairs(locs) do
                local name = get_loc_name(loc):lower()
                if search_text == "" or name:find(search_text, 1, true) then
                    result[#result + 1] = {loc = loc, map = map_name, idx = i}
                end
            end
        end
    else
    
        for i, loc in ipairs(get_locs()) do
            local name = get_loc_name(loc):lower()
            if search_text == "" or name:find(search_text, 1, true) then
                result[#result + 1] = {loc = loc, map = current_map, idx = i}
            end
        end
    end
    return result
end

local function refresh_list()
    local items = {}
    local filtered = get_filtered_locs()
    

    local seen = {}
    for _, entry in ipairs(filtered) do
        local loc = entry.loc
        local w = WEAPONS[loc.weapon]
        local name = get_loc_name(loc)
        local display_name = "[" .. (w and w.name or "?") .. "] " .. name
        
    
        if ui_all_maps:get() then
            display_name = "[" .. entry.map .. "] " .. display_name
        end
        
    
        local key = name .. "_" .. (loc.weapon or "")
        if not opt_hide_duplicates() or not seen[key] then
            items[#items + 1] = display_name
            seen[key] = true
        end
    end
    
    if #items == 0 then
        items[1] = "(No locations)"
    end
    ui_list:set_options(items)
end

ui_search:add_callback(refresh_list)
ui_all_maps:add_callback(refresh_list)

local function load_to_editor()
    local idx = ui_list:get_index() + 1
    local filtered = get_filtered_locs()
    
    if idx >= 1 and idx <= #filtered then
        local entry = filtered[idx]
        local loc = entry.loc
        editing_loc = loc
        editing_index = entry.idx
        
    
        if ui_all_maps:get() then
            current_map = entry.map
        end
        
    
        editor_pos = loc.position or {0, 0, 0}
        editor_ang = loc.viewangles or {0, 0}
        
        ui_ed_name:set(get_loc_name(loc))
        ui_ed_desc:set(get_loc_desc(loc))
        
    
        for i, key in ipairs(WEAPON_KEYS) do
            if key == loc.weapon then
                ui_ed_type:set(i - 1)
                break
            end
        end
        
    
        local g = loc.grenade or {}
        ui_ed_jump:set(g.jump or false)
        ui_ed_duck:set(loc.duck or false)
        
    
        local str = g.strength or 1
        for i, v in ipairs(STRENGTH_VALUES) do
            if v == str then
                ui_ed_strength:set(i - 1)
                break
            end
        end
        
    
        local run = g.run or 0
        if run == 5 then
            ui_ed_run:set(5) 
            ui_ed_run_custom:set(g.run_custom or 0)
        else
            for i, v in ipairs(RUN_VALUES) do
                if v == run then
                    ui_ed_run:set(i - 1)
                    break
                end
            end
        end
        
        ui_ed_run_duration:set(g.run_duration or 20)
        ui_ed_run_walk:set(g.run_walk or false)
        ui_ed_delay:set(g.delay or 0)
        
    
        local recovery = g.recovery or 0
        if recovery == 5 then
            ui_ed_recovery:set(5) 
            ui_ed_recovery_custom:set(g.recovery_custom or 0)
        else
            for i, v in ipairs(RUN_VALUES) do
                if v == recovery then
                    ui_ed_recovery:set(i - 1)
                    break
                end
            end
        end
        ui_ed_recovery_bhop:set(g.recovery_bhop or false)
        
        utils.console_print(color(100, 200, 255, 255), "[GH] Loaded: " .. get_loc_name(loc) .. "\n")
    else
        editing_loc = nil
        editing_index = -1
    end
end

local function btn_update_closest()
    if not utils.is_in_game() then return end
    local lp = entities.get_local_player()
    if not lp or not lp:is_alive() then return end
    
    local pos = lp:get_abs_origin()
    local locs = get_locs()
    local best_idx, best_d = -1, math.huge
    
    for i, loc in ipairs(locs) do
        local p = vector(loc.position[1], loc.position[2], loc.position[3])
        local d = pos:dist(p)
        if d < best_d then
            best_d = d
            best_idx = i
        end
    end
    
    if best_idx > 0 then
        ui_list:set(best_idx - 1)
        load_to_editor()
    end
end

local ui_btn_closest = container:add_button("Closest", btn_update_closest)
local ui_btn_load_sel = container:add_button("Load Sel", load_to_editor)

ui_list:add_callback(load_to_editor)

local function btn_export_loc()
    local filtered = get_filtered_locs()
    local idx = ui_list:get_index() + 1
    if idx >= 1 and idx <= #filtered then
        input.set_clipboard(json.encode(filtered[idx].loc))
        utils.console_print(color(100, 255, 100, 255), "[GH] Exported location to clipboard\n")
    end
end

local ui_btn_delete_loc, ui_btn_confirm_loc, ui_btn_cancel_loc

local function btn_delete_loc_click()
    delete_loc_confirm_mode = true
    ui_btn_delete_loc:set_visibility(false)
    ui_btn_confirm_loc:set_visibility(true)
    ui_btn_cancel_loc:set_visibility(true)
end

local function btn_confirm_loc_click()
    local filtered = get_filtered_locs()
    local idx = ui_list:get_index() + 1
    if idx >= 1 and idx <= #filtered then
        local entry = filtered[idx]
        local name = get_loc_name(entry.loc)
        table.remove(locations_data[entry.map], entry.idx)
        save_data()
        refresh_list()
        editing_loc = nil
        editing_index = -1
        utils.console_print(color(255, 200, 100, 255), "[GH] Deleted: " .. name .. "\n")
    end
    delete_loc_confirm_mode = false
    ui_btn_delete_loc:set_visibility(true)
    ui_btn_confirm_loc:set_visibility(false)
    ui_btn_cancel_loc:set_visibility(false)
end

local function btn_cancel_loc_click()
    delete_loc_confirm_mode = false
    ui_btn_delete_loc:set_visibility(true)
    ui_btn_confirm_loc:set_visibility(false)
    ui_btn_cancel_loc:set_visibility(false)
end

local ui_btn_export_loc = container:add_button("Export Loc", btn_export_loc)
ui_btn_delete_loc = container:add_button("Delete Loc", btn_delete_loc_click)
ui_btn_confirm_loc = container:add_button("Confirm", btn_confirm_loc_click)
ui_btn_cancel_loc = container:add_button("Cancel", btn_cancel_loc_click)
ui_btn_confirm_loc:set_visibility(false)
ui_btn_cancel_loc:set_visibility(false)

local ui_sep1 = container:add_seperator()

local ui_lbl_editor = container:add_label("Editor")

local ui_ed_type = container:add_dropdown("Type", WEAPON_LIST)
local ui_ed_name = container:add_text_box("Name")
local ui_ed_desc = container:add_text_box("Description")
local ui_ed_jump = container:add_checkbox("Jump")
local ui_ed_duck = container:add_checkbox("Duck")

local ui_ed_run = container:add_dropdown("Run", RUN_NAMES)
local ui_ed_run_custom = container:add_slider("Run Direction", -180, 180, 1, "")
ui_ed_run_custom:set(0)
ui_ed_run_custom:set_visibility(false)
local ui_ed_run_duration = container:add_slider("Run Duration", 0, 256, 1, "t")
ui_ed_run_duration:set(20)
local ui_ed_run_walk = container:add_checkbox("Walk (Shift)")
ui_ed_run_walk:add_tooltip("Hold shift while running")

ui_ed_run:add_callback(function()
    local is_custom = ui_ed_run:get_index() == 5 
    ui_ed_run_custom:set_visibility(is_custom)

    local is_disabled = ui_ed_run:get_index() == 0
    ui_ed_run_duration:set_visibility(not is_disabled)
    ui_ed_run_walk:set_visibility(not is_disabled)
end)

local ui_ed_strength = container:add_dropdown("Strength", STRENGTH_NAMES)

local ui_ed_delay = container:add_slider("Delay", 0, 64, 1, "t")
ui_ed_delay:set(0)
ui_ed_delay:add_tooltip("0 = Off")

local ui_ed_recovery = container:add_dropdown("Recovery", RECOVERY_NAMES)
ui_ed_recovery:add_tooltip("Movement after throw")
local ui_ed_recovery_custom = container:add_slider("Recovery Direction", -180, 180, 1, "")
ui_ed_recovery_custom:set(0)
ui_ed_recovery_custom:set_visibility(false)
local ui_ed_recovery_bhop = container:add_checkbox("Bunny Hop")
ui_ed_recovery_bhop:add_tooltip("Bunny hop during recovery")
ui_ed_recovery_bhop:set_visibility(false)

ui_ed_recovery:add_callback(function()
    local is_custom = ui_ed_recovery:get_index() == 5
    local is_disabled = ui_ed_recovery:get_index() == 0
    ui_ed_recovery_custom:set_visibility(is_custom)
    ui_ed_recovery_bhop:set_visibility(not is_disabled)
end)

local function btn_set_position()
    if not utils.is_in_game() then
        utils.console_print(color(255, 100, 100, 255), "[GH] Not in game\n")
        return
    end
    
    local lp = entities.get_local_player()
    if not lp or not lp:is_alive() then
        utils.console_print(color(255, 100, 100, 255), "[GH] Not alive\n")
        return
    end
    
    local pos = lp:get_abs_origin()
    local ang = camera.get_angles()
    
    editor_pos = {pos.x, pos.y, pos.z}
    editor_ang = {ang.x, ang.y}
    
    utils.console_print(color(100, 255, 100, 255), string.format("[GH] Position set: %.1f, %.1f, %.1f | Angles: %.1f, %.1f\n", 
        pos.x, pos.y, pos.z, ang.x, ang.y))
end

local function btn_teleport()
    if not utils.is_in_game() then
        utils.console_print(color(255, 100, 100, 255), "[GH] Not in game\n")
        return
    end
    
    if editor_pos[1] == 0 and editor_pos[2] == 0 and editor_pos[3] == 0 then
        utils.console_print(color(255, 100, 100, 255), "[GH] No position set\n")
        return
    end
    

    local cmd = string.format("setpos %.2f %.2f %.2f; setang %.2f %.2f 0", 
        editor_pos[1], editor_pos[2], editor_pos[3],
        editor_ang[1], editor_ang[2])
    utils.console_exec(cmd)
    
    utils.console_print(color(100, 255, 100, 255), "[GH] Teleported (requires sv_cheats 1)\n")
end

local function btn_save()
    if not utils.is_in_game() then
        utils.console_print(color(255, 100, 100, 255), "[GH] Not in game\n")
        return
    end
    
    if editor_pos[1] == 0 and editor_pos[2] == 0 and editor_pos[3] == 0 then
        utils.console_print(color(255, 100, 100, 255), "[GH] Set position first!\n")
        return
    end
    
    local name = ui_ed_name:get()
    if name == "" then name = "Loc_" .. math.floor(globals.get_real_time()) end
    
    local run_idx = ui_ed_run:get_index() + 1
    local recovery_idx = ui_ed_recovery:get_index() + 1
    
    local new_loc = {
        name = name,
        weapon = WEAPON_KEYS[ui_ed_type:get_index() + 1],
        position = {editor_pos[1], editor_pos[2], editor_pos[3]},
        viewangles = {editor_ang[1], editor_ang[2]},
        duck = ui_ed_duck:get(),
        description = ui_ed_desc:get(),
        grenade = {
            strength = STRENGTH_VALUES[ui_ed_strength:get_index() + 1],
            jump = ui_ed_jump:get(),
            run = RUN_VALUES[run_idx],
            run_custom = ui_ed_run_custom:get(),
            run_duration = ui_ed_run_duration:get(),
            run_walk = ui_ed_run_walk:get(),
            delay = ui_ed_delay:get(),
            recovery = RUN_VALUES[recovery_idx],
            recovery_custom = ui_ed_recovery_custom:get(),
            recovery_bhop = ui_ed_recovery_bhop:get()
        }
    }
    
    if not locations_data[current_map] then
        locations_data[current_map] = {}
    end
    

    if editing_index > 0 and editing_index <= #locations_data[current_map] then
        locations_data[current_map][editing_index] = new_loc
        utils.console_print(color(100, 255, 100, 255), "[GH] Updated: " .. name .. "\n")
    else
    
        locations_data[current_map][#locations_data[current_map] + 1] = new_loc
        utils.console_print(color(100, 255, 100, 255), "[GH] Created: " .. name .. "\n")
    end
    
    save_data()
    refresh_list()
end

local function btn_create_new()
    editing_loc = nil
    editing_index = -1
    editor_pos = {0, 0, 0}
    editor_ang = {0, 0}
    ui_ed_name:set("")
    ui_ed_desc:set("")
    ui_ed_type:set(0)
    ui_ed_jump:set(false)
    ui_ed_duck:set(false)
    ui_ed_run:set(0)
    ui_ed_run_custom:set(0)
    ui_ed_run_duration:set(20)
    ui_ed_run_walk:set(false)
    ui_ed_strength:set(0)
    ui_ed_delay:set(0)
    ui_ed_recovery:set(0)
    ui_ed_recovery_custom:set(0)
    ui_ed_recovery_bhop:set(false)
    utils.console_print(color(100, 200, 255, 255), "[GH] Editor cleared\n")
end

local ui_btn_setpos = container:add_button("Set Pos", btn_set_position)
local ui_btn_tp = container:add_button("Teleport", btn_teleport)
local ui_btn_save = container:add_button("Save", btn_save)
local ui_btn_new = container:add_button("New", btn_create_new)

local ui_sep2 = container:add_seperator()

local ui_lbl_map = container:add_label("Map")

local function btn_export_map()
    local locs = get_locs()
    if #locs == 0 then
        utils.console_print(color(255, 100, 100, 255), "[GH] No locations on this map\n")
        return
    end
    input.set_clipboard(json.encode({[current_map] = locs}))
    utils.console_print(color(100, 255, 100, 255), "[GH] Exported " .. #locs .. " locations for " .. current_map .. "\n")
end

local function btn_delete_map()
    if current_map == "" then return end
    locations_data[current_map] = nil
    save_data()
    refresh_list()
    utils.console_print(color(255, 200, 100, 255), "[GH] Deleted all locations for " .. current_map .. "\n")
end

local ui_btn_export_map = container:add_button("Export Map", btn_export_map)
local ui_btn_clear_map = container:add_button("Clear Map", btn_delete_map)

local ui_btn_import = container:add_button("Import Clipboard", btn_import_source)
local ui_btn_export = container:add_button("Export Source", btn_export_source)
local ui_import_filename = container:add_text_box("Import File")
ui_import_filename:add_tooltip("Filename without .json - reads from grenade_helper folder")
local ui_btn_import_file = container:add_button("Import File", btn_import_file)
local ui_btn_delete_src = container:add_button("Delete Source", btn_delete_source)

edit_elements = {
    ui_lbl_locations,
    ui_search,
    ui_all_maps,
    ui_list,
    ui_btn_closest,
    ui_btn_load_sel,
    ui_btn_export_loc,
    ui_btn_delete_loc,
    ui_btn_confirm_loc,
    ui_btn_cancel_loc,
    ui_sep1,
    ui_lbl_editor,
    ui_ed_type,
    ui_ed_name,
    ui_ed_desc,
    ui_ed_jump,
    ui_ed_duck,
    ui_ed_run,
    ui_ed_run_custom,
    ui_ed_run_duration,
    ui_ed_run_walk,
    ui_ed_strength,
    ui_ed_delay,
    ui_ed_recovery,
    ui_ed_recovery_custom,
    ui_ed_recovery_bhop,
    ui_btn_setpos,
    ui_btn_tp,
    ui_btn_save,
    ui_btn_new,
    ui_sep2,
    ui_lbl_map,
    ui_btn_export_map,
    ui_btn_clear_map,
    ui_btn_import,
    ui_btn_export,
    ui_btn_delete_src
}

update_edit_visibility()

local MAX_DRAW_DIST = 650
local ACTIVATION_RANGE = 50

local function passes_filter(wep)
    return passes_type_filter(wep)
end

local function is_visible(from, to, skip)
    local filter = trace_filter(skip)
    local r = trace.line(from, to, filter)
    return r.fraction > 0.97
end

local function find_active(player_pos, wep, cam_ang)
    local best, best_d = nil, math.huge
    local max_d = MAX_DRAW_DIST
    local max_fov = ui_fov:get()
    
    for _, loc in ipairs(get_locs()) do
        if loc.weapon == wep and passes_filter(wep) then
            local p = vector(loc.position[1], loc.position[2], loc.position[3])
            local d = player_pos:dist(p)
            
            if d <= max_d then
                local tgt_y = loc.viewangles[2]
                local y_diff = math.abs(math.angle_diff(cam_ang.y, tgt_y))
                local p_diff = math.abs(cam_ang.x - loc.viewangles[1])
                local fov = math.sqrt(p_diff * p_diff + y_diff * y_diff)
                
                if fov <= max_fov and d < best_d then
                    best_d = d
                    best = loc
                end
            end
        end
    end
    return best, best_d
end


local function lerp_alpha(current, target, speed, easing_fn)
    return ease.apply(current, target, speed, easing_fn or ease.cosine_in_out)
end

local function get_anim(loc)
    local name = get_loc_name(loc)
    local key = name .. "_" .. tostring(loc.position[1] or 0)
    if not anim_state[key] then
        anim_state[key] = {
            visible_alpha = 0,
            distance_width = 0,
            on_screen = 0,
            in_fov = 0,
            offscreen_alpha = 0,
            icon_pulse = 0
        }
    end
    return anim_state[key]
end

local function render_marker(loc, player_pos, eye_pos, dist, is_closest, main_col)
    local p = vector(loc.position[1], loc.position[2], loc.position[3])
    local scr = p:to_screen()
    if not scr then return end
    
    local max_d = MAX_DRAW_DIST
    local anim = get_anim(loc)
    

    local lp = entities.get_local_player()
    local visible = is_visible(eye_pos, p, lp)
    

    local show_behind = opt_show_behind()
    local target_alpha = 1
    if not visible then
        target_alpha = show_behind and 0.45 or 0
    end
    

    anim.visible_alpha = lerp_alpha(anim.visible_alpha, target_alpha, show_behind and 5.5 or 7.5, ease.cosine_in_out)
    

    if anim.visible_alpha < 0.01 then return end
    

    local dist_alpha = clamp(1 - (dist / max_d) * 0.5, 0.3, 1)
    local alpha = dist_alpha * anim.visible_alpha
    

    local in_range = dist < ACTIVATION_RANGE * 2
    local target_width = in_range and 1 or 0
    anim.distance_width = lerp_alpha(anim.distance_width, target_width, 6, ease.quartic_out)
    

    local base_radius = clamp(18 - (dist / max_d) * 10, 6, 18)
    local radius = base_radius * (0.7 + 0.3 * anim.distance_width)
    
    local w = WEAPONS[loc.weapon]
    local base_col = w and w.col or main_col
    

    local col
    if is_closest then
        col = color(100, 255, 100, math.floor(255 * alpha))
    else
        col = color(base_col.r, base_col.g, base_col.b, math.floor(base_col.a * alpha))
    end
    

    if is_closest then
    
        render.filled_circle(scr, radius + 24, color(100, 255, 100, clamp(math.floor(2 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 21, color(100, 255, 100, clamp(math.floor(4 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 18, color(100, 255, 100, clamp(math.floor(6 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 16, color(100, 255, 100, clamp(math.floor(8 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 14, color(100, 255, 100, clamp(math.floor(10 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 12, color(100, 255, 100, clamp(math.floor(13 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 10, color(100, 255, 100, clamp(math.floor(16 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 8, color(100, 255, 100, clamp(math.floor(20 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 6, color(100, 255, 100, clamp(math.floor(28 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 4, color(100, 255, 100, clamp(math.floor(38 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 3, color(100, 255, 100, clamp(math.floor(50 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 2, color(100, 255, 100, clamp(math.floor(65 * alpha), 0, 255)))
    else
    
        render.filled_circle(scr, radius + 20, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(2 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 17, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(4 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 14, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(6 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 12, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(9 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 10, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(12 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 8, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(16 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 6, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(22 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 4, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(30 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 3, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(40 * alpha), 0, 255)))
        render.filled_circle(scr, radius + 2, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(55 * alpha), 0, 255)))
    end
    

    render.filled_circle(scr, radius, col)
    

    local icon = weapon_icons[loc.weapon]
    if icon and icon.texture then
        local icon_scale = (radius * 2) / math.max(icon.size.x, icon.size.y, 1)
        local icon_w = icon.size.x * icon_scale * 0.7
        local icon_h = icon.size.y * icon_scale * 0.7
        local icon_pos = vector2d(scr.x - icon_w / 2, scr.y - icon_h / 2)
        render.image(icon.texture, icon_pos, vector2d(icon_w, icon_h), color(255, 255, 255, clamp(math.floor(255 * alpha), 0, 255)))
    end
    

    render.circle(scr, radius + 2, color(0, 0, 0, clamp(math.floor(15 * alpha), 0, 255)), 1)
    render.circle(scr, radius + 1, color(0, 0, 0, clamp(math.floor(40 * alpha), 0, 255)), 1)
    render.circle(scr, radius, color(0, 0, 0, clamp(math.floor(100 * alpha), 0, 255)), 1)
    render.circle(scr, radius - 1, color(0, 0, 0, clamp(math.floor(30 * alpha), 0, 255)), 1)
    

    local show_text = not opt_hide_icon() or anim.distance_width < 0.5
    

    if (dist < 200 or is_closest) and anim.distance_width > 0.1 then
        local font = render.get_small_font()
        local menu_font = render.get_menu_font()
        local name_text = "\194\187 " .. get_loc_name(loc)
        local desc = get_loc_desc(loc)
        local name_sz = render.get_text_size(menu_font, name_text)
        
    
        local desc_sz = vector2d(0, 0)
        if desc ~= "" then
            desc = string.upper(desc):gsub("(.)", "%1  "):sub(1, -3)
            desc_sz = render.get_text_size(font, desc)
        end
        
    
        local icon_half = math.floor(name_sz.y * 0.5 - 1)
        local icon_area = math.floor(icon_half * 2.25)
        
    
        local on_screen = anim.distance_width
        local on_screen_eased = ease.quartic_out(clamp(on_screen, 0, 1))
        
    
        local expand_offset = 0
        local half_desc = math.floor(desc_sz.y * 0.5)
        if on_screen > 0 then
            expand_offset = math.floor((icon_area + 7) * on_screen) + half_desc
        end
        
    
        local content_w = math.max(name_sz.x, desc_sz.x)
        local content_h = name_sz.y + desc_sz.y
        local total_w = content_w + expand_offset
        
    
        local scr_w = render.get_screen_size()
        local bx = math.min(scr.x - icon_area * 0.5 - half_desc * 0.5, scr_w.x - 40 - total_w)
        local by = scr.y - content_h * 0.5
        local ex = bx + total_w
        local ey = by + content_h
        
    
        local box_ease = ease.quartic_out(clamp(alpha, 0, 1))
        
    
        local bg_a = math.floor(180 * box_ease)
        render.filled_rect(vector2d(bx - 2, by - 2), vector2d(total_w + 4, content_h + 4), color(16, 16, 16, bg_a))
        
    
    
        render.rect(vector2d(bx - 3, by - 3), vector2d(total_w + 6, content_h + 6), color(16, 16, 16, math.floor(170 * box_ease)))
    
        render.rect(vector2d(bx - 4, by - 4), vector2d(total_w + 8, content_h + 8), color(16, 16, 16, math.floor(195 * box_ease)))
    
        render.rect(vector2d(bx - 5, by - 5), vector2d(total_w + 10, content_h + 10), color(16, 16, 16, math.floor(40 * box_ease)))
        
    
        if on_screen > 0.5 then
            local circle_center = vector2d(bx + icon_area + half_desc * 0.5, by + content_h * 0.5)
            local circle_r = icon_area * 0.5
            local circle_alpha = 255 * alpha * ease.quartic_out(on_screen)
            
        
            local circle_col
            if is_closest then
            
                circle_col = color(col.r, col.g, col.b, math.floor(circle_alpha))
                render.filled_circle(circle_center, circle_r, circle_col)
            else
            
                local base_circle = color(base_col.r, base_col.g, base_col.b, math.floor(circle_alpha))
            
                render.circle(circle_center, circle_r + 1, color(16, 16, 16, math.floor(circle_alpha * 0.5)), 2)
            
                render.filled_circle(circle_center, circle_r, base_circle)
            
                render.circle(circle_center, circle_r + 1, color(16, 16, 16, math.floor(circle_alpha * 0.3)), 2)
                render.circle(circle_center, circle_r, color(16, 16, 16, math.floor(circle_alpha * 0.2)), 2)
                render.circle(circle_center, circle_r - 1, color(16, 16, 16, math.floor(circle_alpha * 0.1)), 2)
            end
        end
        
    
        local text_x = bx + expand_offset
        if expand_offset > 1 then
            local bar_col = color(col.r, col.g, col.b, math.floor(255 * alpha * on_screen))
            render.filled_rect(vector2d(text_x - 4, by + 1), vector2d(1, content_h - 1), bar_col)
        end
        
    
        local text_alpha = math.floor(255 * alpha)
        local text_col = color(col.r, col.g, col.b, text_alpha)
        render.push_clip_rect(vector2d(text_x, by), vector2d(ex - text_x, ey - by))
        render.text(menu_font, name_text, vector2d(text_x, by - 1), text_col)
        render.pop_clip_rect()
        
    
        if desc ~= "" then
            local desc_col = color(col.r, col.g, col.b, math.floor(text_alpha * 0.8))
            render.text(font, desc, vector2d(text_x, by + name_sz.y), desc_col)
        end
    end
    

    if dist < 300 or is_closest then
        local font = render.get_small_font()
        local dist_txt = string.format("%.0fu", dist)
        local dsz = render.get_text_size(font, dist_txt)
        render.text(font, dist_txt, vector2d(scr.x - dsz.x/2, scr.y + radius + 4), color(180, 180, 180, math.floor(180 * alpha)))
    end
end

local function render_offscreen_indicator(loc, player_pos, cam_ang, scr_size, main_col)
    local p = vector(loc.position[1], loc.position[2], loc.position[3])
    local dist = player_pos:dist(p)
    if dist > MAX_DRAW_DIST then return end
    if not passes_filter(loc.weapon) then return end
    

    local scr = p:to_screen()
    if scr then return end 
    
    local anim = get_anim(loc)
    

    local dir = vector(p.x - player_pos.x, p.y - player_pos.y, p.z - player_pos.z)
    local dir_ang = dir:to_angles()
    

    local dy = math.angle_diff(cam_ang.y, dir_ang.y)
    local dp = dir_ang.x - cam_ang.x
    

    local angle = math.atan2(-dy, dp)
    

    local margin = 50
    local cx, cy = scr_size.x / 2, scr_size.y / 2
    local half_w = cx - margin
    local half_h = cy - margin
    

    local cos_a = math.cos(angle)
    local sin_a = math.sin(angle)
    
    local scale_x = (cos_a ~= 0) and math.abs(half_w / cos_a) or math.huge
    local scale_y = (sin_a ~= 0) and math.abs(half_h / sin_a) or math.huge
    local s = math.min(scale_x, scale_y)
    
    local ix = cx + cos_a * s
    local iy = cy + sin_a * s
    

    ix = clamp(ix, margin, scr_size.x - margin)
    iy = clamp(iy, margin, scr_size.y - margin)
    

    anim.offscreen_alpha = lerp_alpha(anim.offscreen_alpha, 1, 5, ease.sine_out)
    local alpha = anim.offscreen_alpha * clamp(1 - (dist / MAX_DRAW_DIST) * 0.6, 0.3, 1)
    if alpha < 0.01 then return end
    
    local w = WEAPONS[loc.weapon]
    local base_col = w and w.col or main_col
    local a = clamp(math.floor(200 * alpha), 0, 255)
    local a_dim = clamp(math.floor(120 * alpha), 0, 255)
    

    local arrow_size = 12
    local arrow_angle = math.atan2(iy - cy, ix - cx)
    

    local tip_x = ix
    local tip_y = iy
    

    local perp_x = -math.sin(arrow_angle) * arrow_size * 0.6
    local perp_y = math.cos(arrow_angle) * arrow_size * 0.6
    local back_x = ix - math.cos(arrow_angle) * arrow_size
    local back_y = iy - math.sin(arrow_angle) * arrow_size
    

    render.filled_circle(vector2d(ix, iy), arrow_size + 14, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(3 * alpha), 0, 255)))
    render.filled_circle(vector2d(ix, iy), arrow_size + 11, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(6 * alpha), 0, 255)))
    render.filled_circle(vector2d(ix, iy), arrow_size + 8, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(12 * alpha), 0, 255)))
    render.filled_circle(vector2d(ix, iy), arrow_size + 6, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(20 * alpha), 0, 255)))
    render.filled_circle(vector2d(ix, iy), arrow_size + 4, color(base_col.r, base_col.g, base_col.b, clamp(math.floor(30 * alpha), 0, 255)))
    render.filled_circle(vector2d(ix, iy), arrow_size + 2, color(16, 16, 16, clamp(math.floor(160 * alpha), 0, 255)))
    

    render.filled_triangle(
        vector2d(tip_x, tip_y),
        vector2d(back_x + perp_x, back_y + perp_y),
        vector2d(back_x - perp_x, back_y - perp_y),
        color(base_col.r, base_col.g, base_col.b, a)
    )
    

    render.triangle(
        vector2d(tip_x, tip_y),
        vector2d(back_x + perp_x, back_y + perp_y),
        vector2d(back_x - perp_x, back_y - perp_y),
        color(0, 0, 0, a_dim)
    )
    

    local font = render.get_small_font()
    local dist_txt = string.format("%.0fu", dist)
    local dsz = render.get_text_size(font, dist_txt)
    local txt_x = clamp(ix - dsz.x / 2, 5, scr_size.x - dsz.x - 5)
    local txt_y = clamp(iy + arrow_size + 6, 5, scr_size.y - dsz.y - 5)
    render.text(font, dist_txt, vector2d(txt_x, txt_y), color(base_col.r, base_col.g, base_col.b, a_dim))
end

local function render_aim_direction(loc, player_pos, cam_ang, scr_size)
    local anim = get_anim(loc)
    

    local tgt_p = loc.viewangles[1]
    local tgt_y = loc.viewangles[2]
    

    local throw_pos = vector(loc.position[1], loc.position[2], loc.position[3] + 64)
    

    local rad_p = math.rad(tgt_p)
    local rad_y = math.rad(tgt_y)
    local dir = vector(
        math.cos(rad_p) * math.cos(rad_y),
        math.cos(rad_p) * math.sin(rad_y),
        -math.sin(rad_p)
    )
    

    local aim_point = vector(
        throw_pos.x + dir.x * 700,
        throw_pos.y + dir.y * 700,
        throw_pos.z + dir.z * 700
    )
    
    local aim_scr = aim_point:to_screen()
    if not aim_scr then return end
    
    local font = render.get_small_font()
    local w = WEAPONS[loc.weapon]
    local accent = w and w.col or color(100, 200, 255, 255)
    

    local dp = tgt_p - cam_ang.x
    local dy = math.angle_diff(cam_ang.y, tgt_y)
    local fov = math.sqrt(dp * dp + dy * dy)
    local on_fov = fov < 2
    

    local target_fov_anim = on_fov and 1 or 0
    anim.in_fov = lerp_alpha(anim.in_fov, target_fov_anim, on_fov and 2.5 or 4.5, ease.quad_in_out)
    

    local target_screen = 1
    anim.on_screen = lerp_alpha(anim.on_screen, target_screen, 4.5, ease.sine_out)
    

    local base_col = color(accent.r, accent.g, accent.b, 200)
    local green_col = color(100, 255, 100, 220)
    

    local r = math.floor(base_col.r + (green_col.r - base_col.r) * anim.in_fov)
    local g = math.floor(base_col.g + (green_col.g - base_col.g) * anim.in_fov)
    local b = math.floor(base_col.b + (green_col.b - base_col.b) * anim.in_fov)
    local circle_col = color(r, g, b, math.floor(220 * anim.on_screen))
    

    local circle_size = clamp(12 - fov * 0.5, 6, 14) * (0.8 + 0.2 * anim.on_screen)
    


    render.filled_circle(aim_scr, circle_size + 16, color(r, g, b, clamp(math.floor(2 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 13, color(r, g, b, clamp(math.floor(4 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 11, color(r, g, b, clamp(math.floor(6 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 9, color(r, g, b, clamp(math.floor(9 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 7, color(r, g, b, clamp(math.floor(13 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 5, color(r, g, b, clamp(math.floor(18 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 4, color(r, g, b, clamp(math.floor(25 * anim.on_screen), 0, 255)))
    render.filled_circle(aim_scr, circle_size + 3, color(r, g, b, clamp(math.floor(35 * anim.on_screen), 0, 255)))
    

    render.circle(aim_scr, circle_size + 3, color(0, 0, 0, clamp(math.floor(60 * anim.on_screen), 0, 255)), 2)
    render.circle(aim_scr, circle_size + 2, color(0, 0, 0, clamp(math.floor(100 * anim.on_screen), 0, 255)), 1)
    

    render.filled_circle(aim_scr, circle_size, color(16, 16, 16, clamp(math.floor(200 * anim.on_screen), 0, 255)))
    

    render.circle(aim_scr, circle_size, circle_col, 2)
    render.circle(aim_scr, circle_size - 1, color(r, g, b, clamp(math.floor(80 * anim.on_screen), 0, 255)), 1)
    render.circle(aim_scr, circle_size - 2, color(r, g, b, clamp(math.floor(40 * anim.on_screen), 0, 255)), 1)
    

    if anim.in_fov > 0.3 then
        local dot_alpha = math.floor(255 * anim.in_fov * anim.on_screen)
        render.filled_circle(aim_scr, 3, color(r, g, b, dot_alpha))
    end
    

    local name = " " .. get_loc_name(loc)
    local desc = get_loc_desc(loc)
    local name_sz = render.get_text_size(font, name)
    
    local box_w = name_sz.x + 20
    local box_h = name_sz.y + 6
    if desc ~= "" then
    
        desc = string.upper(desc):gsub(".", "%1 "):sub(1, -2)
        local desc_sz = render.get_text_size(font, desc)
        box_w = math.max(box_w, desc_sz.x + 20)
        box_h = box_h + desc_sz.y + 2
    end
    
    local bx = aim_scr.x + circle_size + 8
    local by = aim_scr.y - box_h / 2
    

    if bx + box_w > scr_size.x - 10 then
        bx = aim_scr.x - circle_size - 8 - box_w
    end
    
    local box_alpha = anim.on_screen
    

    render.filled_rect(vector2d(bx - 2, by - 2), vector2d(box_w + 4, box_h + 4), color(16, 16, 16, math.floor(180 * box_alpha)), 0)
    render.rect(vector2d(bx - 3, by - 3), vector2d(box_w + 6, box_h + 6), color(40, 40, 40, math.floor(170 * box_alpha)), 0)
    render.rect(vector2d(bx - 4, by - 4), vector2d(box_w + 8, box_h + 8), color(30, 30, 30, math.floor(100 * box_alpha)), 0)
    render.rect(vector2d(bx - 5, by - 5), vector2d(box_w + 10, box_h + 10), color(20, 20, 20, math.floor(40 * box_alpha)), 0)
    

    render.filled_rect(vector2d(bx, by), vector2d(3, box_h), color(r, g, b, math.floor(255 * box_alpha)), 0)
    

    render.text(font, name, vector2d(bx + 8, by + 3), color(255, 255, 255, math.floor(255 * box_alpha)))
    if desc ~= "" then
        render.text(font, desc, vector2d(bx + 8, by + 3 + name_sz.y + 2), color(180, 180, 180, math.floor(220 * box_alpha)))
    end
    

    local fov_txt = string.format("%.1f", fov)
    local fov_sz = render.get_text_size(font, fov_txt)
    local fov_col = on_fov and color(100, 255, 100, math.floor(255 * box_alpha)) or color(255, 200, 100, math.floor(255 * box_alpha))
    render.text(font, fov_txt, vector2d(aim_scr.x - fov_sz.x/2, aim_scr.y + circle_size + 4), fov_col)
end

local function render_aim_ind(loc, cam_ang, scr_size)
    local tgt_p, tgt_y = loc.viewangles[1], loc.viewangles[2]
    local dp = tgt_p - cam_ang.x
    local dy = math.angle_diff(cam_ang.y, tgt_y)
    
    local cx, cy = scr_size.x / 2, scr_size.y / 2
    local tx = clamp(cx - dy * 4, 40, scr_size.x - 40)
    local ty = clamp(cy + dp * 4, 40, scr_size.y - 40)
    

    render.line(vector2d(cx, cy), vector2d(tx, ty), color(255, 200, 100, 180), 2)
    

    render.line(vector2d(tx - 8, ty), vector2d(tx + 8, ty), color(255, 255, 255, 255), 2)
    render.line(vector2d(tx, ty - 8), vector2d(tx, ty + 8), color(255, 255, 255, 255), 2)
end

local function render_info(loc, scr_size)
    local font = render.get_small_font()
    local menu_font = render.get_menu_font()
    
    local wdata = WEAPONS[loc.weapon]
    local accent = wdata and wdata.col or color(100, 200, 255, 255)
    local g = loc.grenade or {}
    

    local lines = {}
    

    lines[#lines + 1] = {255, 255, 255, 240, get_loc_name(loc)}
    

    lines[#lines + 1] = {180, 180, 180, 200, "Type: " .. (wdata and wdata.name or "Unknown")}
    

    local str = g.strength or 1
    local str_name = str == 1 and "Left Click" or (str == 0 and "Right Click" or "Both (Left + Right)")
    lines[#lines + 1] = {180, 180, 180, 200, "Throw: " .. str_name}
    

    local reqs = {}
    if loc.duck then reqs[#reqs + 1] = "Duck" end
    if g.jump then reqs[#reqs + 1] = "Jump" end
    if g.run and g.run > 0 then
        local run_dirs = {"Forward", "Left", "Right", "Back", "Custom"}
        reqs[#reqs + 1] = "Run(" .. (run_dirs[g.run] or "?") .. ")"
    end
    if g.walk then reqs[#reqs + 1] = "Walk" end
    if g.delay and g.delay > 0 then reqs[#reqs + 1] = "Delay:" .. g.delay end
    lines[#lines + 1] = {180, 180, 180, 200, "Req: " .. (#reqs > 0 and table.concat(reqs, " + ") or "None")}
    

    lines[#lines + 1] = {255, 255, 255, 255, " "}
    

    if throw_data.active then
        lines[#lines + 1] = {100, 255, 100, 255, "Ready - Hold Attack to Throw"}
    else
        lines[#lines + 1] = {255, 180, 100, 220, "Move to Position"}
    end
    

    local max_w = 0
    local total_h = 0
    local line_offsets = {}
    for i = 1, #lines do
        local sz = render.get_text_size(font, lines[i][5])
        if sz.x > max_w then max_w = sz.x end
        line_offsets[i] = total_h
        total_h = total_h + sz.y
        if i == 1 then total_h = total_h + 2 end
    end
    

    local px = math.floor(scr_size.x * 0.5 - max_w * 0.5)
    local py = 140
    

    render.filled_rect(
        vector2d(px - 4, py - 3),
        vector2d(max_w + 8, total_h + 6),
        color(16, 16, 16, 105)
    )
    


    render.rect(
        vector2d(px - 5, py - 4),
        vector2d(max_w + 10, total_h + 8),
        color(16, 16, 16, 120)
    )

    render.rect(
        vector2d(px - 6, py - 5),
        vector2d(max_w + 12, total_h + 10),
        color(16, 16, 16, 135)
    )

    render.rect(
        vector2d(px - 7, py - 6),
        vector2d(max_w + 14, total_h + 12),
        color(16, 16, 16, 28)
    )
    

    render.filled_rect(
        vector2d(px + 13, py),
        vector2d(1, 12),
        accent
    )
    

    for i = 1, #lines do
        local ln = lines[i]
        render.text(font, ln[5], vector2d(px - 2, py + line_offsets[i]), color(ln[1], ln[2], ln[3], ln[4]))
    end
end

local function render_debug(loc, player_pos, cam_ang, scr_size)
    local font = render.get_small_font()
    local x, y = 10, 10
    local line = 13
    local start_y = y
    
    local function dbg(label, value, col)
        col = col or color(200, 200, 200, 255)
        render.text(font, label .. ": " .. tostring(value), vector2d(x, y), col)
        y = y + line
    end
    

    local total_lines = 20
    if loc then total_lines = 28 end
    local h = total_lines * line + 10
    

    render.filled_rect(vector2d(x - 5, start_y - 5), vector2d(200, h), color(10, 10, 10, 230), 4)
    render.rect(vector2d(x - 6, start_y - 6), vector2d(202, h + 2), color(60, 60, 60, 200), 4)
    render.filled_rect(vector2d(x - 5, start_y - 5), vector2d(3, h), color(255, 100, 100, 255), 4)
    
    render.text(font, "GRENADE HELPER DEBUG", vector2d(x, y), color(255, 100, 100, 255))
    y = y + line + 2
    

    local stage_names = {"IDLE", "RUNNING", "THROW", "HOLD", "RECOVERY"}
    local stage_col = throw_data.stage == 0 and color(150, 150, 150, 255) or color(100, 255, 100, 255)
    dbg("Status", stage_names[throw_data.stage + 1] or "?", stage_col)
    dbg("Tick", throw_data.tick)
    dbg("Active", throw_data.active and "YES" or "NO", throw_data.active and color(100, 255, 100, 255) or color(255, 100, 100, 255))
    
    y = y + 2
    
    if loc then
        local target_pos = vector(loc.position[1], loc.position[2], loc.position[3])
        local dist_3d = player_pos:dist(target_pos)
        local dist_2d = player_pos:dist2d(target_pos)
        local on_pos = dist_2d < 0.5 and dist_3d < 5
        
        dbg("Location", get_loc_name(loc), color(100, 200, 255, 255))
        dbg("Dist3D", string.format("%.2fu", dist_3d))
        dbg("Dist2D", string.format("%.2fu", dist_2d))
        dbg("OnPos", on_pos and "YES" or "NO", on_pos and color(100, 255, 100, 255) or color(255, 200, 100, 255))
        
        y = y + 2
        
        local tgt_p, tgt_y = loc.viewangles[1], loc.viewangles[2]
        local dp = tgt_p - cam_ang.x
        local dy = math.angle_diff(cam_ang.y, tgt_y)
        local fov = math.sqrt(dp * dp + dy * dy)
        local on_fov = fov < 2
        
        dbg("FOV", string.format("%.2f", fov), on_fov and color(100, 255, 100, 255) or color(255, 200, 100, 255))
        dbg("dPitch", string.format("%.2f", dp))
        dbg("dYaw", string.format("%.2f", dy))
        dbg("OnFOV", on_fov and "YES" or "NO", on_fov and color(100, 255, 100, 255) or color(255, 200, 100, 255))
        
        y = y + 2
        
        local g = loc.grenade or {}
        dbg("Duck", loc.duck and "Y" or "N")
        dbg("Jump", g.jump and "Y" or "N")
        dbg("Run", g.run or 0)
        dbg("Str", g.strength or 1)
        dbg("Delay", g.delay or 0)
    else
        dbg("Location", "NONE", color(255, 100, 100, 255))
    end
    
    y = y + 2
    
    local key = ui_throw_key:get()
    local key_down = key ~= -1 and input.is_key_down(key)
    dbg("AutoThrow", opt_auto_throw() and "ON" or "OFF", opt_auto_throw() and color(100, 255, 100, 255) or color(150, 150, 150, 255))
    dbg("Key", key == -1 and "NONE" or tostring(key))
    dbg("KeyDown", key_down and "Y" or "N", key_down and color(100, 255, 100, 255) or color(150, 150, 150, 255))
    
    dbg("PosX", string.format("%.1f", player_pos.x), color(120, 120, 120, 255))
    dbg("PosY", string.format("%.1f", player_pos.y), color(120, 120, 120, 255))
    dbg("PosZ", string.format("%.1f", player_pos.z), color(120, 120, 120, 255))
end

local function on_render()
    if not ui_enabled:get() or not utils.is_in_game() then return end
    

    load_weapon_icons()
    
    local lp = entities.get_local_player()
    if not lp or not lp:is_alive() then return end
    
    local wep = lp:get_weapon()
    if not wep then return end
    
    local wep_name = wep:get_name()
    if not WEAPONS[wep_name] or not passes_filter(wep_name) then return end
    
    local player_pos = lp:get_abs_origin()
    local eye_pos = lp:get_eye_pos()
    local cam_ang = camera.get_angles()
    local scr_size = render.get_screen_size()
    local main_col = ui_color:get()
    
    local best, best_d = find_active(player_pos, wep_name, cam_ang)
    local act_range = ACTIVATION_RANGE
    local max_dist = MAX_DRAW_DIST
    

    for _, loc in ipairs(get_locs()) do
        if loc.weapon == wep_name and passes_filter(wep_name) then
            local p = vector(loc.position[1], loc.position[2], loc.position[3])
            local dist = player_pos:dist(p)
            
            if dist <= max_dist then
                local is_closest = (loc == best)
                local scr = p:to_screen()
                
                if scr then
                
                    render_marker(loc, player_pos, eye_pos, dist, is_closest, main_col)
                    local anim = get_anim(loc)
                    anim.offscreen_alpha = lerp_alpha(anim.offscreen_alpha, 0, 8, ease.quartic_out)
                else
                
                    if opt_show_behind() then
                        render_offscreen_indicator(loc, player_pos, cam_ang, scr_size, main_col)
                    end
                end
            end
        end
    end
    

    if best and best_d <= act_range then
        active_loc = best
        throw_data.active = true
        
    
        if opt_aim_ind() then
            render_aim_direction(best, player_pos, cam_ang, scr_size)
            render_aim_ind(best, cam_ang, scr_size)
        end
        
        if opt_info_panel() then
            render_info(best, scr_size)
        end
        
    
        if opt_debug() then
            render_debug(best, player_pos, cam_ang, scr_size)
        end
    else
        active_loc = nil
        throw_data.active = false
        throw_data.stage = 0
        
    
        if opt_debug() then
            render_debug(nil, player_pos, cam_ang, scr_size)
        end
    end
end

local function on_move(cmd)

    if throw_data.stage == 4 and throw_data.loc then
        local g = throw_data.loc.grenade or {}
        local recovery = g.recovery or 0
        local recovery_custom = g.recovery_custom or 0
        local recovery_bhop = g.recovery_bhop or false
        throw_data.tick = throw_data.tick + 1
        
    
        if recovery > 0 then
            local tgt_y = throw_data.loc.viewangles[2]
            cmd.move_yaw = tgt_y
            
            local speed = 450
            if recovery == 1 then 
                cmd.forward_move = speed
                cmd.in_forward = true
            elseif recovery == 2 then 
                cmd.left_move = speed
                cmd.in_moveleft = true
            elseif recovery == 3 then 
                cmd.left_move = -speed
                cmd.in_moveright = true
            elseif recovery == 4 then 
                cmd.forward_move = -speed
                cmd.in_back = true
            elseif recovery == 5 then 
                local rad = math.rad(recovery_custom)
                cmd.forward_move = math.cos(rad) * speed
                cmd.left_move = math.sin(rad) * speed
                if cmd.forward_move > 0 then cmd.in_forward = true else cmd.in_back = true end
                if cmd.left_move > 0 then cmd.in_moveleft = true else cmd.in_moveright = true end
            end
            
        
        
            if recovery_bhop then
                if throw_data.tick % 2 == 0 then
                    cmd.in_jump = true
                end
            
                if throw_data.tick % 4 < 2 then
                    cmd.left_move = (cmd.left_move or 0) + 50
                else
                    cmd.left_move = (cmd.left_move or 0) - 50
                end
            end
        end
        
    
        local recovery_duration = recovery_bhop and 40 or 32
        if throw_data.tick >= recovery_duration then
            throw_data.stage = 0
            throw_data.tick = 0
            throw_data.loc = nil
        end
        return
    end
    
    if not ui_enabled:get() or not active_loc then
        if throw_data.stage < 4 then
            throw_data.stage = 0
        end
        return
    end
    
    local lp = entities.get_local_player()
    if not lp or not lp:is_alive() then return end
    
    local loc = active_loc
    local tgt_p = loc.viewangles[1]
    local tgt_y = loc.viewangles[2]
    
    local g = loc.grenade or {}
    local needs_duck = loc.duck
    local needs_jump = g.jump
    local run_dir = g.run or 0
    local run_custom = g.run_custom or 0
    local run_duration = g.run_duration or 20
    local run_walk = g.run_walk or false
    local strength = g.strength or 1
    local delay = g.delay or 0
    local recovery = g.recovery or 0
    local recovery_custom = g.recovery_custom or 0
    local recovery_bhop = g.recovery_bhop or false
    

    local player_pos = lp:get_abs_origin()
    local target_pos = vector(loc.position[1], loc.position[2], loc.position[3])
    

    local dist_2d = player_pos:dist2d(target_pos)
    local dist_3d = player_pos:dist(target_pos)
    

    local on_position = dist_2d < 0.5 and dist_3d < 5
    

    local should_throw = opt_auto_throw()
    if not should_throw then
        local key = ui_throw_key:get()
        if key ~= -1 and input.is_key_down(key) then
            should_throw = true
        end
    end
    


    local manual_move = cmd.in_forward or cmd.in_back or cmd.in_moveleft or cmd.in_moveright
    
    if should_throw and not on_position and not manual_move and throw_data.stage < 2 then
    
        local dir = vector(target_pos.x - player_pos.x, target_pos.y - player_pos.y, 0)
        local dir_angles = dir:to_angles()
        
    
        cmd.move_yaw = dir_angles.y
        
    
        if opt_auto_duck() and needs_duck then
            cmd.in_duck = true
        end
        
    
        if dist_2d > 14 then
            cmd.forward_move = 450 
        elseif dist_2d > 1 then
        
            cmd.forward_move = clamp(dist_2d * 30, 10, 250)
        else
        
            cmd.forward_move = clamp(dist_2d * 50, 6, 50)
        end
        cmd.in_forward = true
        
        return 
    end
    

    if ui_silent:get() and (on_position or throw_data.stage >= 1) then
        cmd.view_angles.x = tgt_p
        cmd.view_angles.y = tgt_y
        cmd.move_yaw = tgt_y
    end
    

    if opt_auto_duck() and needs_duck then
        cmd.in_duck = true
    end
    

    local function apply_movement(direction, custom_angle, use_walk)
        local speed = use_walk and 130 or 450
        if direction == 1 then 
            cmd.forward_move = speed
            cmd.in_forward = true
        elseif direction == 2 then 
            cmd.left_move = speed
            cmd.in_moveleft = true
        elseif direction == 3 then 
            cmd.left_move = -speed
            cmd.in_moveright = true
        elseif direction == 4 then 
            cmd.forward_move = -speed
            cmd.in_back = true
        elseif direction == 5 then 
        
            local rad = math.rad(custom_angle)
            cmd.forward_move = math.cos(rad) * speed
            cmd.left_move = math.sin(rad) * speed
            if cmd.forward_move > 0 then cmd.in_forward = true else cmd.in_back = true end
            if cmd.left_move > 0 then cmd.in_moveleft = true else cmd.in_moveright = true end
        end
    
    end
    






    
    if should_throw and on_position then
        throw_data.tick = throw_data.tick + 1
        
        if throw_data.stage == 0 then
            throw_data.stage = 1
            throw_data.tick = 0
            throw_data.loc = loc
        end
        
        if throw_data.stage == 1 then
        
            if opt_auto_run() and run_dir > 0 then
                apply_movement(run_dir, run_custom, run_walk)
            end
            
        
            if throw_data.tick >= (run_duration + delay) then
                throw_data.stage = 2
                throw_data.tick = 0
            end
        end
        
        if throw_data.stage == 2 then
        
            if opt_auto_jump() and needs_jump then
                cmd.in_jump = true
            end
            
        
            if strength == 1 then
                cmd.in_attack = true
            elseif strength == 0 then
                cmd.in_attack2 = true
            else
                cmd.in_attack = true
                cmd.in_attack2 = true
            end
            
            throw_data.stage = 3
            throw_data.tick = 0
        end
        
        if throw_data.stage == 3 then
        
            if strength == 1 then
                cmd.in_attack = true
            elseif strength == 0 then
                cmd.in_attack2 = true
            else
                cmd.in_attack = true
                cmd.in_attack2 = true
            end
            
        
            if throw_data.tick >= 2 then
                if recovery > 0 then
                    throw_data.stage = 4
                    throw_data.tick = 0
                else
                    throw_data.stage = 0
                    throw_data.tick = 0
                    throw_data.loc = nil
                end
            end
        end
    else
    
        if throw_data.stage > 0 and throw_data.stage < 2 and not should_throw then
            throw_data.stage = 0
            throw_data.tick = 0
        end
    end
end

local function on_level_init()
    current_map = globals.get_map_name_short()
    refresh_list()
    active_loc = nil
    editing_loc = nil
    editing_index = -1
    throw_data = {active = false, tick = 0, stage = 0, loc = nil}
    utils.console_print(color(100, 200, 255, 255), "[GH] Map loaded: " .. current_map .. "\n")
end

local function on_level_shutdown()
    current_map = ""
    active_loc = nil
    editing_loc = nil
    throw_data.active = false
end

callbacks.add(on_render)
callbacks.add(on_move)
callbacks.add(on_level_init)
callbacks.add(on_level_shutdown)

load_sources()
load_data()
if utils.is_in_game() then
    current_map = globals.get_map_name_short()
    refresh_list()
end

utils.console_print(color(100, 200, 255, 255), "[Grenade Helper] Location Editor Loaded\n")
utils.console_print(color(100, 200, 255, 255), "[GH] Sources: " .. table.concat(sources_list, ", ") .. "\n")
utils.console_print(color(100, 200, 255, 255), "[GH] Active: " .. current_source .. "\n")
